<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mod‰∏≠ÂøÉ - ‰∏ªÊí≠Ê®°ÊãüÂô®</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; 
            background: #0a0a0a; 
            color: #fff; 
            line-height: 1.6;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            padding: 30px 20px; 
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .filter-bar { 
            background: #161823; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .filter-btn { 
            padding: 8px 16px; 
            background: #222; 
            border: 1px solid #333; 
            border-radius: 8px; 
            cursor: pointer;
            transition: all 0.3s;
        }
        .filter-btn.active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border-color: #667eea;
        }
        .mod-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        .mod-card { 
            background: #161823; 
            border: 1px solid #333; 
            border-radius: 15px; 
            padding: 20px;
            transition: transform 0.2s, border-color 0.3s;
        }
        .mod-card:hover { 
            border-color: #667eea; 
            transform: translateY(-5px);
        }
        .mod-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .mod-name { font-size: 18px; font-weight: bold; color: #fff; }
        .mod-type { 
            background: linear-gradient(135deg, #00f2ea 0%, #667eea 100%); 
            color: #000; 
            padding: 4px 8px; 
            border-radius: 5px; 
            font-size: 12px;
            font-weight: bold;
        }
        .mod-description { 
            font-size: 14px; 
            color: #ccc; 
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .mod-meta { 
            font-size: 12px; 
            color: #999; 
            display: flex; 
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .mod-actions { 
            display: flex; 
            gap: 10px; 
        }
        .btn { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #fff;
        }
        .btn-secondary { background: #222; color: #ccc; border: 1px solid #333; }
        .btn:active { transform: scale(0.95); }
        .loading { text-align: center; padding: 40px; color: #999; }
        .error { text-align: center; padding: 40px; color: #ff0050; }
        .empty { text-align: center; padding: 40px; color: #999; }
        .upload-btn { 
            position: fixed; 
            bottom: 30px; 
            right: 30px; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            background: linear-gradient(135deg, #00f2ea 0%, #667eea 100%); 
            color: #000; 
            border: none; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0, 242, 234, 0.3);
            transition: all 0.3s;
        }
        .upload-btn:hover { transform: translateY(-5px); box-shadow: 0 6px 20px rgba(0, 242, 234, 0.5); }
        .code-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0,0,0,0.9); 
            z-index: 1000;
        }
        .code-content { 
            background: #161823; 
            margin: 50px auto; 
            max-width: 800px; 
            border-radius: 15px; 
            padding: 20px;
            max-height: 80vh;
            overflow: auto;
        }
        .code-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .code-textarea { 
            width: 100%; 
            min-height: 400px; 
            background: #0a0a0a; 
            border: 1px solid #333; 
            border-radius: 8px; 
            color: #00ff00; 
            font-family: 'Courier New', monospace; 
            font-size: 13px; 
            padding: 15px;
            resize: vertical;
        }
        .copy-btn { 
            background: #00f2ea; 
            color: #000; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 5px; 
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÆ ‰∏ªÊí≠Ê®°ÊãüÂô®Mod‰∏≠ÂøÉ</h1>
        <p style="margin-top: 10px; opacity: 0.9;">ÂèëÁé∞Á≤æÂΩ©ModÔºåÊâ©Â±ïÊ∏∏Êàè‰πêË∂£ÔºÅ</p>
    </div>

    <div class="container">
        <div class="filter-bar">
            <div class="filter-btn active" onclick="filterMods('all')">ÂÖ®ÈÉ®</div>
            <div class="filter-btn" onclick="filterMods('ÂäüËÉΩÂ¢ûÂº∫')">ÂäüËÉΩÂ¢ûÂº∫</div>
            <div class="filter-btn" onclick="filterMods('Ëá™Âä®Âåñ')">Ëá™Âä®Âåñ</div>
            <div class="filter-btn" onclick="filterMods('Ë∂£Âë≥Áé©Ê≥ï')">Ë∂£Âë≥Áé©Ê≥ï</div>
            <div class="filter-btn" onclick="filterMods('ËßÜËßâ‰ºòÂåñ')">ËßÜËßâ‰ºòÂåñ</div>
        </div>

        <div id="modsList" class="mod-grid">
            <div class="loading">Ê≠£Âú®Âä†ËΩΩModÂàóË°®...</div>
        </div>
    </div>

    <button class="upload-btn" onclick="location.href='upload.html'" title="‰∏ä‰º†Mod">+</button>

    <div class="code-modal" id="codeModal">
        <div class="code-content">
            <div class="code-header">
                <h2 id="codeModalTitle">Mod‰ª£Á†Å</h2>
                <div>
                    <button class="copy-btn" onclick="copyCode()">Â§çÂà∂‰ª£Á†Å</button>
                    <button class="btn btn-secondary" onclick="closeCodeModal()">ÂÖ≥Èó≠</button>
                </div>
            </div>
            <textarea class="code-textarea" id="codeModalText" readonly></textarea>
        </div>
    </div>

    <script>
        const GITHUB_REPO = 'liveforl/liveforl.github.io'; // ‰øÆÊîπËøôÈáå
        const ISSUES_API = `https://api.github.com/repos/${GITHUB_REPO}/issues`;

        let allMods = [];
        let currentFilter = 'all';

        // Âä†ËΩΩModÂàóË°®
        async function loadMods() {
            const container = document.getElementById('modsList');
            
            try {
                // ‰ΩøÁî®GitHub APIËé∑ÂèñIssuesÔºà‰ªÖËé∑ÂèñÊ†áÁ≠æ‰∏∫"ModÊèê‰∫§"ÁöÑÔºâ
                const response = await fetch(`${ISSUES_API}?labels=ModÊèê‰∫§&state=open&per_page=100`);
                
                if (!response.ok) {
                    throw new Error('Êó†Ê≥ïÂä†ËΩΩModÂàóË°®');
                }
                
                const issues = await response.json();
                
                // Ëß£ÊûêIssues‰∏∫ModÊï∞ÊçÆ
                allMods = issues.map(issue => {
                    // ‰ªéIssue bodyËß£ÊûêMod‰ø°ÊÅØ
                    const body = issue.body || '';
                    const lines = body.split('\n');
                    
                    return {
                        id: issue.number,
                        name: extractField(lines, 'ÂêçÁß∞'),
                        description: extractField(lines, 'ÊèèËø∞'),
                        type: extractField(lines, 'Á±ªÂûã'),
                        version: extractField(lines, 'ÁâàÊú¨Ë¶ÅÊ±Ç'),
                        code: extractCode(body),
                        author: issue.user.login,
                        createdAt: issue.created_at,
                        url: issue.html_url,
                        reactions: issue.reactions
                    };
                }).filter(mod => mod.name && mod.code); // ËøáÊª§Êó†ÊïàÊï∞ÊçÆ
                
                renderMods();
                
            } catch (error) {
                console.error('Âä†ËΩΩModÂ§±Ë¥•:', error);
                container.innerHTML = `<div class="error">Âä†ËΩΩÂ§±Ë¥•: ${error.message}</div>`;
            }
        }

        // ‰ªéIssue bodyÊèêÂèñÂ≠óÊÆµ
        function extractField(lines, fieldName) {
            const line = lines.find(l => l.includes(`**${fieldName}**`));
            if (!line) return '';
            return line.split('**')[2].replace('**', '').trim() || '';
        }

        // ÊèêÂèñ‰ª£Á†ÅÂùó
        function extractCode(body) {
            const match = body.match(/```javascript\n([\s\S]*?)\n```/);
            return match ? match[1] : '';
        }

        // Ê∏≤ÊüìModÂàóË°®
        function renderMods() {
            const container = document.getElementById('modsList');
            
            // ËøáÊª§
            let modsToShow = currentFilter === 'all' 
                ? allMods 
                : allMods.filter(mod => mod.type === currentFilter);
            
            if (modsToShow.length === 0) {
                container.innerHTML = '<div class="empty">ÊöÇÊó†Mod</div>';
                return;
            }
            
            container.innerHTML = modsToShow.map(mod => `
                <div class="mod-card">
                    <div class="mod-header">
                        <div class="mod-name">${mod.name}</div>
                        <div class="mod-type">${mod.type}</div>
                    </div>
                    <div class="mod-description">${mod.description}</div>
                    <div class="mod-meta">
                        <span>‰ΩúËÄÖ: @${mod.author}</span>
                        <span>${formatDate(mod.createdAt)}</span>
                    </div>
                    <div class="mod-actions">
                        <button class="btn btn-primary" onclick="viewCode(${mod.id})">Êü•Áúã‰ª£Á†Å</button>
                        <button class="btn btn-secondary" onclick="downloadMod(${mod.id})">‰∏ãËΩΩ</button>
                        <button class="btn btn-secondary" onclick="openIssue('${mod.url}')">ËØ¶ÊÉÖ</button>
                    </div>
                </div>
            `).join('');
        }

        // ËøáÊª§Mod
        function filterMods(type) {
            currentFilter = type;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderMods();
        }

        // Êü•ÁúãMod‰ª£Á†Å
        function viewCode(modId) {
            const mod = allMods.find(m => m.id === modId);
            if (!mod) return;
            
            document.getElementById('codeModalTitle').textContent = mod.name;
            document.getElementById('codeModalText').value = mod.code;
            document.getElementById('codeModal').style.display = 'block';
        }

        // ÂÖ≥Èó≠‰ª£Á†ÅÂºπÁ™ó
        function closeCodeModal() {
            document.getElementById('codeModal').style.display = 'none';
        }

        // Â§çÂà∂‰ª£Á†Å
        function copyCode() {
            const textarea = document.getElementById('codeModalText');
            textarea.select();
            document.execCommand('copy');
            alert('‰ª£Á†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
        }

        // ‰∏ãËΩΩMod
        function downloadMod(modId) {
            const mod = allMods.find(m => m.id === modId);
            if (!mod) return;
            
            const blob = new Blob([mod.code], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${mod.name.replace(/\s+/g, '_')}.js`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ÊâìÂºÄGitHub Issue
        function openIssue(url) {
            window.open(url, '_blank');
        }

        // Ê†ºÂºèÂåñÊó•Êúü
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'ÂàöÂàö';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'ÂàÜÈíüÂâç';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'Â∞èÊó∂Ââç';
            if (diff < 604800000) return Math.floor(diff / 86400000) + 'Â§©Ââç';
            
            return date.toLocaleDateString('zh-CN');
        }

        // ÂàùÂßãÂåñÂä†ËΩΩ
        loadMods();
        
        // ÊØè30ÁßíËá™Âä®Âà∑Êñ∞
        setInterval(loadMods, 30000);
    </script>
</body>
</html>
