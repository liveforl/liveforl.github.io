<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>AI 2048 – 数字可见版</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg0:#0a0a0f;--bg1:#12121a;--gridBg:#0d0d15;
  --neonCyan:#00f0ff;--neonPurple:#b000ff;--neonPink:#ff008c;
  --glass:rgba(20,20,35,.55);
  --shadowCyan:0 0 4px var(--neonCyan),0 0 12px var(--neonCyan);
  --shadowPurple:0 0 4px var(--neonPurple),0 0 12px var(--neonPurple);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Orbitron',sans-serif;background:var(--bg0);
  background-image:linear-gradient(var(--bg1) 1px,transparent 1px),linear-gradient(90deg,var(--bg1) 1px,transparent 1px);
  background-size:40px 40px;color:#fff;display:flex;flex-direction:column;align-items:center;padding:10px;min-height:100vh
}
.container{width:100%;max-width:500px;background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--neonCyan);box-shadow:var(--shadowCyan);border-radius:16px;padding:20px;margin-top:20px}
h1{text-align:center;font-size:clamp(26px,5vw,38px);letter-spacing:2px;color:var(--neonCyan);text-shadow:var(--shadowCyan);margin-bottom:20px}
.info-panel{display:flex;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px}
.info-box{flex:1;min-width:100px;background:rgba(0,240,255,.08);border:1px solid var(--neonCyan);border-radius:8px;padding:10px;text-align:center;font-size:14px;letter-spacing:1px;color:var(--neonCyan);box-shadow:inset 0 0 6px var(--neonCyan)}
.info-box span{font-weight:700;color:var(--neonPink);text-shadow:0 0 4px var(--neonPink)}
.controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
button{flex:1;padding:12px 20px;border:1px solid;border-radius:8px;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;letter-spacing:1px;color:#fff;background:transparent}
.start-btn{border-color:var(--neonCyan);text-shadow:var(--shadowCyan)}
.start-btn:hover{background:var(--neonCyan);color:var(--bg0);box-shadow:var(--shadowCyan)}
.pause-btn{border-color:var(--neonPurple);text-shadow:var(--shadowPurple)}
.pause-btn:hover{background:var(--neonPurple);color:#fff;box-shadow:var(--shadowPurple)}
.reset-btn{border-color:var(--neonPink);text-shadow:0 0 4px var(--neonPink)}
.reset-btn:hover{background:var(--neonPink);color:#fff;box-shadow:0 0 12px var(--neonPink)}
.game-board{background:var(--gridBg);border:1px solid var(--neonPurple);box-shadow:var(--shadowPurple);border-radius:10px;padding:10px;width:100%;aspect-ratio:1;max-width:400px;margin:0 auto}
.grid-container{display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);gap:10px;height:100%;width:100%}
.tile{background:rgba(255,255,255,.04);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:clamp(16px,4vw,24px);color:#fff;transition:all .15s ease-in-out;border:1px solid transparent}
.tile[data-value]{border-color:var(--neonCyan);box-shadow:inset 0 0 8px var(--neonCyan),0 0 8px var(--neonCyan)}
.tile[data-value="2"]{background:rgba(0,240,255,.1)}
.tile[data-value="4"]{background:rgba(0,240,255,.18)}
.tile[data-value="8"]{background:rgba(0,240,255,.25)}
.tile[data-value="16"]{background:rgba(176,0,255,.3)}
.tile[data-value="32"]{background:rgba(176,0,255,.4)}
.tile[data-value="64"]{background:rgba(176,0,255,.5)}
.tile[data-value="128"]{background:rgba(255,0,140,.55);font-size:clamp(14px,3.5vw,20px)}
.tile[data-value="256"]{background:rgba(255,0,140,.65);font-size:clamp(14px,3.5vw,20px)}
.tile[data-value="512"]{background:rgba(255,0,140,.75);font-size:clamp(14px,3.5vw,20px)}
.tile[data-value="1024"]{background:linear-gradient(135deg,var(--neonCyan),var(--neonPink));color:var(--bg0);font-size:clamp(12px,3vw,18px);text-shadow:none}
.tile[data-value="2048"]{background:linear-gradient(135deg,#fff,var(--neonPurple));color:var(--bg0);font-size:clamp(12px,3vw,18px);text-shadow:none;animation:pulse 1.2s infinite}
@keyframes pulse{0%{transform:scale(1);box-shadow:0 0 10px #fff,0 0 20px var(--neonPurple)}50%{transform:scale(1.05);box-shadow:0 0 20px #fff,0 0 40px var(--neonPurple)}100%{transform:scale(1);box-shadow:0 0 10px #fff,0 0 20px var(--neonPurple)}}
.tile.merged{animation:mergeFlash .2s ease-out}
@keyframes mergeFlash{0%{filter:brightness(1)}50%{filter:brightness(2);transform:scale(1.15)}100%{filter:brightness(1);transform:scale(1)}}
.ai-status{margin-top:20px;padding:10px;text-align:center;border-radius:8px;background:rgba(0,240,255,.08);border:1px solid var(--neonCyan);color:var(--neonCyan);font-weight:700;letter-spacing:1px;text-shadow:var(--shadowCyan)}
.ai-status.thinking{background:rgba(176,0,255,.08);border-color:var(--neonPurple);color:var(--neonPurple);text-shadow:var(--shadowPurple)}
.keyboard-hint{margin-top:10px;text-align:center;font-size:12px;color:var(--neonCyan);opacity:.7}
@media (max-width:480px){.container{padding:15px}button{font-size:14px;padding:10px 15px}.info-box{font-size:12px}}
</style>
</head>

<body>
<div class="container">
  <h1>CYBER 2048 ∞ AI</h1>
  <div class="info-panel">
    <div class="info-box">SCORE <span id="score">0</span></div>
    <div class="info-box">BEST <span id="best">0</span></div>
    <div class="info-box">MOVES <span id="moves">0</span></div>
    <div class="info-box">MAX <span id="max-tile">0</span></div>
  </div>
  <div class="controls">
    <button class="start-btn" onclick="startAI()">START AI</button>
    <button class="pause-btn" onclick="pauseAI()">PAUSE</button>
    <button class="reset-btn" onclick="resetGame()">RESET</button>
  </div>
  <div class="game-board">
    <div class="grid-container" id="grid"></div>
  </div>
  <div class="ai-status" id="ai-status">AI READY</div>
  <div class="keyboard-hint">方向键手动操作　空格键暂停/继续 AI</div>
</div>

<script>
/* ---------- 核心变量 ---------- */
let board, score, bestScore, moves, isRunning, aiInterval, gameOver;
bestScore = Number(localStorage.getItem('best2048')) || 0;

/* ---------- 初始化 ---------- */
function initGame() {
  board = Array.from({length:4},()=>[0,0,0,0]);
  score = 0; moves = 0; gameOver = false;
  addRandomTile(); addRandomTile();
  updateDisplay();
  document.getElementById('best').textContent = bestScore;
}
function createGrid() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  for (let i=0;i<16;i++){
    const t = document.createElement('div');
    t.className = 'tile'; t.id = `t-${i}`;
    grid.appendChild(t);
  }
}

/* ---------- 显示更新（关键修复点） ---------- */
function updateDisplay() {
  for (let i=0;i<4;i++){
    for (let j=0;j<4;j++){
      const idx = i*4+j, tile=document.getElementById(`t-${idx}`), v=board[i][j];
      tile.textContent = v||'';                 // ← 确保数字出现
      tile.setAttribute('data-value',v||'');    // ← 样式依赖
    }
  }
  document.getElementById('score').textContent = score;
  document.getElementById('moves').textContent = moves;
  document.getElementById('max-tile').textContent = getMaxTile();
  if (score>bestScore){bestScore=score; localStorage.setItem('best2048',bestScore); document.getElementById('best').textContent=bestScore;}
}
function getMaxTile(){return Math.max(...board.flat());}

/* ---------- 游戏逻辑 ---------- */
function addRandomTile() {
  const empt=[],v=Math.random()<.9?2:4;
  for (let i=0;i<4;i++)for(let j=0;j<4;j++)if(!board[i][j])empt.push({i,j});
  if (empt.length){const {i,j}=empt[Math.floor(Math.random()*empt.length)]; board[i][j]=v;}
}
function move(dir){
  if (gameOver)return false;
  let moved=false,merged=Array.from({length:4},()=>[0,0,0,0]);
  const old=board.map(r=>[...r]);
  if (dir==='left'){
    for (let i=0;i<4;i++){
      let row=board[i].filter(v=>v);
      for (let j=0;j<row.length-1;j++){if(row[j]===row[j+1]){row[j]*=2; score+=row[j]; merged[i][j]=1; row.splice(j+1,1);}}
      while(row.length<4)row.push(0); board[i]=row;
    }
  } else if (dir==='right'){
    for (let i=0;i<4;i++){
      let row=board[i].filter(v=>v).reverse();
      for (let j=0;j<row.length-1;j++){if(row[j]===row[j+1]){row[j]*=2; score+=row[j]; merged[i][3-j]=1; row.splice(j+1,1);}}
      while(row.length<4)row.push(0); board[i]=row.reverse();
    }
  } else if (dir==='up'){
    for (let j=0;j<4;j++){
      let col=[]; for (let i=0;i<4;i++)if(board[i][j])col.push(board[i][j]);
      for (let i=0;i<col.length-1;i++){if(col[i]===col[i+1]){col[i]*=2; score+=col[i]; merged[i][j]=1; col.splice(i+1,1);}}
      while(col.length<4)col.push(0); for(let i=0;i<4;i++)board[i][j]=col[i];
    }
  } else if (dir==='down'){
    for (let j=0;j<4;j++){
      let col=[]; for (let i=3;i>=0;i--)if(board[i][j])col.push(board[i][j]);
      for (let i=0;i<col.length-1;i++){if(col[i]===col[i+1]){col[i]*=2; score+=col[i]; merged[3-i][j]=1; col.splice(i+1,1);}}
      while(col.length<4)col.push(0); for(let i=3;i>=0;i--)board[i][j]=col[3-i];
    }
  }
  for (let i=0;i<4;i++)for(let j=0;j<4;j++)if(board[i][j]!==old[i][j])moved=true;
  if (moved){addRandomTile(); moves++; updateDisplay();}
  return moved;
}

/* ---------- AI ---------- */
function evaluate(){
  let empty=0,mono=0,max=0,corner=0;
  for (let i=0;i<4;i++)for(let j=0;j<4;j++){
    if (!board[i][j])empty++;
    if (board[i][j]>max)max=board[i][j];
  }
  [[0,0],[0,3],[3,0],[3,3]].forEach(([i,j])=>{if(board[i][j]===max)corner+=1000;});
  for (let i=0;i<4;i++){
    for (let j=0;j<3;j++){
      if (board[i][j]>=board[i][j+1])mono+=10; else mono-=10;
      if (board[j][i]>=board[j+1][i])mono+=10; else mono-=10;
    }
  }
  return empty*30 + mono + corner;
}
function getBestMove(){
  const dirs=['up','down','left','right']; let best=-Infinity, mv='up';
  for (const d of dirs){
    const bak=board.map(r=>[...r]), sc=score;
    if (move(d)){const ev=evaluate(); if(ev>best){best=ev; mv=d;} board=bak; score=sc;}
  }
  return mv;
}
function aiMove(){
  if (gameOver){pauseAI(); return;}
  const st=document.getElementById('ai-status');
  st.textContent='AI THINKING...'; st.classList.add('thinking');
  setTimeout(()=>{
    const mv=getBestMove(); move(mv);
    st.textContent=`AI MOVE: ${mv.toUpperCase()}`; st.classList.remove('thinking');
    if (isGameOver()){gameOver=true; pauseAI(); st.textContent='GAME OVER';}
  }, 60);
}
function isGameOver(){
  for (let i=0;i<4;i++)for(let j=0;j<4;j++){
    if (!board[i][j])return false;
    if (j<3&&board[i][j]===board[i][j+1])return false;
    if (i<3&&board[i][j]===board[i+1][j])return false;
  }
  return true;
}

/* ---------- 控制 ---------- */
function startAI(){if (!isRunning&&!gameOver){isRunning=true; aiInterval=setInterval(aiMove,300); document.getElementById('ai-status').textContent='AI RUNNING';}}
function pauseAI(){isRunning=false; if(aiInterval){clearInterval(aiInterval); aiInterval=null;} if(!gameOver)document.getElementById('ai-status').textContent='AI PAUSED';}
function resetGame(){pauseAI(); initGame(); document.getElementById('ai-status').textContent='AI READY';}
document.addEventListener('keydown',e=>{
  if (gameOver)return;
  const key={ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right'}[e.key];
  if (key&&!isRunning){e.preventDefault(); move(key);}
  if (e.key===' '){e.preventDefault(); isRunning?pauseAI():startAI();}
});

/* ---------- 启动 ---------- */
createGrid();
initGame();
</script>
</body>
</html>
