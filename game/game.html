<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸»æ’­æ¨¡æ‹Ÿå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ç™»å½•é¡µé¢ */
        #loginPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-window {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .login-title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-btn:active {
            transform: scale(0.98);
        }

        /* ä¸»é¡µé¢ */
        #mainPage {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            background: #161823;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        .header-title {
            font-size: 18px;
            font-weight: bold;
        }

        .header-right {
            display: flex;
            gap: 15px;
        }

        .header-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff0050;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            min-width: 16px;
            text-align: center;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 60px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background: #161823;
            margin: 10px;
            padding: 15px;
            border-radius: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
        }

        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 10px;
        }

        .action-btn {
            background: #161823;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:active {
            transform: scale(0.98);
            background: #222;
        }

        .action-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .action-text {
            font-size: 14px;
            color: #ccc;
        }

        /* ä½œå“åˆ—è¡¨ */
        .works-section {
            padding: 10px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .work-item {
            background: #161823;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .work-item:active {
            background: #222;
        }

        .work-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .work-type {
            background: #667eea;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
        }

        .work-time {
            font-size: 12px;
            color: #999;
        }

        .work-content {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .work-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
        }

        .stat-number {
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .stat-number.updating {
            color: #00f2ea;
            transform: scale(1.1);
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            background: #161823;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .nav-text {
            font-size: 10px;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: #161823;
            margin: 20px;
            border-radius: 15px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        /* è¾“å…¥æ¡† */
        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }

        .text-input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* æŒ‰é’® */
        .btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #333;
        }

        .btn-danger {
            background: #ff0050;
        }

        /* ç›´æ’­é¡µé¢ */
        .live-container {
            background: #000;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .live-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .live-viewers {
            background: rgba(255, 0, 80, 0.8);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .live-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .live-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .live-controls {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            display: flex;
            gap: 15px;
        }

        .live-btn {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .live-btn-start {
            background: #00f2ea;
            color: #000;
        }

        .live-btn-end {
            background: #ff0050;
            color: white;
        }

        /* å›¾è¡¨é¡µé¢ - ä»¿æŠ–éŸ³é£æ ¼ */
        .chart-container {
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
        }

        .chart-item {
            background: #161823;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            color: #fff;
        }

        .chart-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .chart-canvas {
            width: 100%;
            height: 200px;
            background: #222;
            border-radius: 8px;
        }

        /* è®¾ç½®é¡µé¢ */
        .settings-item {
            background: #161823;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .settings-item:active {
            background: #222;
        }

        .settings-label {
            font-size: 14px;
        }

        .settings-value {
            font-size: 14px;
            color: #999;
        }

        /* æˆå°±é¡µé¢ */
        .achievement-item {
            background: #161823;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .achievement-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .achievement-icon.unlocked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-desc {
            font-size: 12px;
            color: #999;
        }

        /* è¯„è®ºåˆ—è¡¨ */
        .comment-item {
            background: #161823;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-user {
            font-size: 14px;
            font-weight: bold;
        }

        .comment-time {
            font-size: 12px;
            color: #999;
        }

        .comment-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
        }

        .comment-action {
            cursor: pointer;
            transition: color 0.3s;
        }

        .comment-action:active {
            color: #667eea;
        }

        /* è­¦å‘Šæç¤º */
        .warning-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff0050;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 2000;
            display: none;
        }

        /* å°å·é¡µé¢ */
        .banned-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #000;
            padding: 20px;
            text-align: center;
        }

        .banned-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .banned-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .banned-reason {
            font-size: 14px;
            color: #999;
            margin-bottom: 20px;
        }

        .banned-time {
            font-size: 16px;
            color: #ff0050;
            margin-bottom: 30px;
        }

        /* ç›´æ’­æ§åˆ¶æŒ‰é’® */
        .live-control-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: ${props.isLive ? '#ff0050' : '#00f2ea'};
            color: ${props.isLive ? 'white' : 'black'};
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            z-index: 99;
        }

        .live-control-btn:active {
            transform: scale(0.95);
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #161823;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 375px) {
            .stats-card {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage">
        <div class="login-window">
            <div class="login-title">ä¸»æ’­æ¨¡æ‹Ÿå™¨</div>
            <input type="text" class="login-input" id="usernameInput" placeholder="è¯·è¾“å…¥ä½ çš„åå­—" maxlength="20">
            <button class="login-btn" onclick="startGame()">ç¡®å®š</button>
        </div>
    </div>

    <!-- ä¸»é¡µé¢ -->
    <div id="mainPage">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div class="header-left">
                <div class="avatar" id="userAvatar" onclick="showProfile()">A</div>
                <div class="header-title" id="usernameDisplay">ä¸»æ’­</div>
            </div>
            <div class="header-right">
                <div class="header-icon" onclick="showNotifications()">
                    ğŸ””
                    <span class="notification-badge" id="notificationBadge" style="display:none">0</span>
                </div>
                <div class="header-icon" onclick="showSettings()">âš™ï¸</div>
            </div>
        </div>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content" id="mainContent">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-card">
                <div class="stat-item">
                    <div class="stat-value" id="fansCount">0</div>
                    <div class="stat-label">ç²‰ä¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="likesCount">0</div>
                    <div class="stat-label">ç‚¹èµ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="viewsCount">0</div>
                    <div class="stat-label">æ’­æ”¾</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="worksCount">0</div>
                    <div class="stat-label">ä½œå“</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="moneyCount">0</div>
                    <div class="stat-label">é›¶é’±</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="warningCount">0/10</div>
                    <div class="stat-label">è­¦å‘Š</div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <div class="action-btn" onclick="showCreateVideo()">
                    <div class="action-icon">ğŸ¬</div>
                    <div class="action-text">å‘å¸ƒè§†é¢‘</div>
                </div>
                <div class="action-btn" onclick="showCreatePost()">
                    <div class="action-icon">ğŸ“</div>
                    <div class="action-text">å‘å¸ƒåŠ¨æ€</div>
                </div>
                <div class="action-btn" onclick="startLive()">
                    <div class="action-icon">ğŸ“±</div>
                    <div class="action-text">å¼€å§‹ç›´æ’­</div>
                </div>
                <div class="action-btn" onclick="showCharts()">
                    <div class="action-icon">ğŸ“Š</div>
                    <div class="action-text">æ•°æ®åˆ†æ</div>
                </div>
            </div>

            <!-- ä½œå“åˆ—è¡¨ -->
            <div class="works-section">
                <div class="section-title">
                    <span>æˆ‘çš„ä½œå“</span>
                    <span style="font-size:12px;color:#999" id="updateTime">åˆšåˆšæ›´æ–°</span>
                </div>
                <div id="worksList"></div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-text">é¦–é¡µ</div>
            </div>
            <div class="nav-item" onclick="switchTab('works')">
                <div class="nav-icon">ğŸ“¹</div>
                <div class="nav-text">ä½œå“</div>
            </div>
            <div class="nav-item" onclick="switchTab('messages')">
                <div class="nav-icon">ğŸ’¬</div>
                <div class="nav-text">æ¶ˆæ¯</div>
            </div>
            <div class="nav-item" onclick="switchTab('achievements')">
                <div class="nav-icon">ğŸ†</div>
                <div class="nav-text">æˆå°±</div>
            </div>
        </div>

        <!-- ç›´æ’­æ§åˆ¶æŒ‰é’® -->
        <button class="live-control-btn" id="liveControlBtn" onclick="toggleLive()" style="display:none">
            ğŸ“±
        </button>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- è­¦å‘Šæç¤º -->
    <div class="warning-toast" id="warningToast"></div>

    <!-- å°å·é¡µé¢ -->
    <div class="banned-container" id="bannedPage">
        <div class="banned-icon">ğŸš«</div>
        <div class="banned-title">è´¦å·è¢«å°ç¦</div>
        <div class="banned-reason" id="bannedReason">è¿åç¤¾åŒºè§„å®š</div>
        <div class="banned-time" id="bannedTime">å°ç¦æ—¶é—´ï¼šæ°¸ä¹…</div>
        <button class="btn" onclick="appealBan()">ç”³è¯‰</button>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            username: '',
            userId: '',
            avatar: '',
            fans: 0,
            likes: 0,
            views: 0,
            works: 0,
            money: 0,
            warnings: 0,
            isBanned: false,
            banEndTime: null,
            achievements: [],
            worksList: [],
            notifications: [],
            liveStatus: false,
            lastUpdateTime: Date.now(),
            gameStartTime: Date.now(),
            chartData: {
                fans: [],
                likes: [],
                views: []
            },
            liveInterval: null,
            workUpdateIntervals: []
        };

        // æˆå°±åˆ—è¡¨
        const achievements = [
            { id: 1, name: 'åˆå…¥æ±Ÿæ¹–', desc: 'è·å¾—ç¬¬ä¸€ä¸ªç²‰ä¸', icon: 'ğŸŒ±', unlocked: false },
            { id: 2, name: 'å°æœ‰åæ°”', desc: 'ç²‰ä¸è¾¾åˆ°1000', icon: 'ğŸŒŸ', unlocked: false },
            { id: 3, name: 'ç½‘çº¢è¾¾äºº', desc: 'ç²‰ä¸è¾¾åˆ°10ä¸‡', icon: 'â­', unlocked: false },
            { id: 4, name: 'é¡¶çº§æµé‡', desc: 'ç²‰ä¸è¾¾åˆ°1000ä¸‡', icon: 'ğŸŒŸ', unlocked: false },
            { id: 5, name: 'çˆ†æ¬¾åˆ¶é€ æœº', desc: 'å•æ¡è§†é¢‘æ’­æ”¾é‡ç ´ç™¾ä¸‡', icon: 'ğŸ”¥', unlocked: false },
            { id: 6, name: 'ç‚¹èµç‹‚é­”', desc: 'ç´¯è®¡è·å¾—10ä¸‡ä¸ªèµ', icon: 'ğŸ‘', unlocked: false },
            { id: 7, name: 'é«˜äº§åˆ›ä½œè€…', desc: 'å‘å¸ƒ100ä¸ªä½œå“', icon: 'ğŸ“¹', unlocked: false },
            { id: 8, name: 'ç›´æ’­æ–°æ˜Ÿ', desc: 'é¦–æ¬¡ç›´æ’­è·å¾—1000è§‚çœ‹', icon: 'ğŸ“±', unlocked: false },
            { id: 9, name: 'æ”¶ç›Šç¬¬ä¸€æ¡¶é‡‘', desc: 'è·å¾—é¦–æ¬¡æ”¶ç›Š', icon: 'ğŸ’°', unlocked: false },
            { id: 10, name: 'ç™¾ä¸‡å¯Œç¿', desc: 'ç´¯è®¡æ”¶ç›Šè¾¾åˆ°100ä¸‡', icon: 'ğŸ’', unlocked: false },
            { id: 11, name: 'è¯é¢˜ä¹‹ç‹', desc: 'å•æ¡åŠ¨æ€è·å¾—1ä¸‡è½¬å‘', icon: 'ğŸ”', unlocked: false },
            { id: 12, name: 'è¯„è®ºäº’åŠ¨è¾¾äºº', desc: 'å•æ¡ä½œå“è·å¾—5000è¯„è®º', icon: 'ğŸ’¬', unlocked: false },
            { id: 13, name: 'å…¨å‹¤ä¸»æ’­', desc: 'è¿ç»­30å¤©æ›´æ–°', icon: 'ğŸ“…', unlocked: false },
            { id: 14, name: 'é€†é£ç¿»ç›˜', desc: 'ä»å°å·ä¸­ç”³è¯‰æˆåŠŸ', icon: 'ğŸ”„', unlocked: false },
            { id: 15, name: 'å¹¸è¿å„¿', desc: 'è§¦å‘50æ¬¡éšæœºäº‹ä»¶', icon: 'ğŸ€', unlocked: false },
            { id: 16, name: 'ç¤¾äº¤è¾¾äºº', desc: 'å…³æ³¨1000ä¸ªç”¨æˆ·', icon: 'ğŸ‘¥', unlocked: false },
            { id: 17, name: 'å¤œçŒ«å­', desc: 'å‡Œæ™¨3ç‚¹è¿˜åœ¨ç›´æ’­', icon: 'ğŸ¦‰', unlocked: false },
            { id: 18, name: 'æ—©èµ·é¸Ÿå„¿', desc: 'æ—©ä¸Š6ç‚¹å¼€å§‹ç›´æ’­', icon: 'ğŸ¦', unlocked: false },
            { id: 19, name: 'å® ç²‰ç‹‚é­”', desc: 'å›å¤1000æ¡è¯„è®º', icon: 'ğŸ’', unlocked: false },
            { id: 20, name: 'ä¼ å¥‡ä¸»æ’­', desc: 'è§£é”æ‰€æœ‰æˆå°±', icon: 'ğŸ‘‘', unlocked: false }
        ];

        // éšæœºäº‹ä»¶
        const randomEvents = [
            { type: 'good', title: 'è§†é¢‘çˆ†äº†ï¼', desc: 'ä½ çš„è§†é¢‘è¢«æ¨èåˆ°é¦–é¡µï¼Œæ’­æ”¾é‡æš´æ¶¨', effect: { views: 50000, fans: 5000, likes: 3000 } },
            { type: 'good', title: 'è¯é¢˜çƒ­æœ', desc: 'ä½ çš„åŠ¨æ€ç™»ä¸Šçƒ­æœæ¦œ', effect: { views: 20000, fans: 2000, likes: 1500 } },
            { type: 'good', title: 'å¤§Vè½¬å‘', desc: 'çŸ¥ååšä¸»è½¬å‘äº†ä½ çš„ä½œå“', effect: { views: 30000, fans: 3000, likes: 2000 } },
            { type: 'good', title: 'ç²‰ä¸ç¦åˆ©', desc: 'ç²‰ä¸ä»¬ç»™ä½ åˆ·äº†ç¤¼ç‰©', effect: { money: 1000, likes: 500 } },
            { type: 'good', title: 'å“ç‰Œåˆä½œ', desc: 'æœ‰å“ç‰Œæ‰¾ä½ åˆä½œæ¨å¹¿', effect: { money: 5000, fans: 1000 } },
            { type: 'bad', title: 'å†…å®¹äº‰è®®', desc: 'ä½ çš„å†…å®¹å¼•å‘äº‰è®®ï¼Œæœ‰äººä¸¾æŠ¥', effect: { fans: -500, warnings: 1 } },
            { type: 'bad', title: 'é»‘ç²‰æ”»å‡»', desc: 'æœ‰äººç»„ç»‡é»‘ç²‰æ”»å‡»ä½ çš„è´¦å·', effect: { fans: -1000, likes: -500 } },
            { type: 'bad', title: 'ç³»ç»Ÿè¯¯åˆ¤', desc: 'ç³»ç»Ÿè¯¯åˆ¤ä½ çš„å†…å®¹è¿è§„', effect: { warnings: 1 } },
            { type: 'bad', title: 'ç«äº‰å¯¹æ‰‹', desc: 'åŒç±»å‹ä¸»æ’­æŠ¢èµ°äº†ä½ çš„æµé‡', effect: { views: -10000, fans: -800 } },
            { type: 'bad', title: 'ç½‘ç»œæš´åŠ›', desc: 'ä½ è¢«ç½‘æš´äº†ï¼Œå¿ƒæƒ…ä½è½', effect: { fans: -300, likes: -200 } },
            { type: 'neutral', title: 'å¹³æ·¡ä¸€å¤©', desc: 'ä»Šå¤©æ²¡ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…å‘ç”Ÿ', effect: {} },
            { type: 'neutral', title: 'ç²‰ä¸äº’åŠ¨', desc: 'å’Œç²‰ä¸ä»¬èŠå¾—å¾ˆå¼€å¿ƒ', effect: { likes: 100 } },
            { type: 'neutral', title: 'çµæ„Ÿæ¯ç«­', desc: 'ä»Šå¤©æ²¡æœ‰åˆ›ä½œçµæ„Ÿ', effect: {} },
            { type: 'good', title: 'æŠ€èƒ½æå‡', desc: 'ä½ å­¦ä¼šäº†æ–°çš„å‰ªè¾‘æŠ€å·§', effect: { views: 5000 } },
            { type: 'good', title: 'è®¾å¤‡å‡çº§', desc: 'ä½ è´­ä¹°äº†æ–°çš„ç›´æ’­è®¾å¤‡', effect: { fans: 800 } },
            { type: 'bad', title: 'è®¾å¤‡æ•…éšœ', desc: 'ç›´æ’­è®¾å¤‡å‡ºç°æ•…éšœ', effect: { fans: -200 } },
            { type: 'good', title: 'ç²‰ä¸è§é¢ä¼š', desc: 'ä¸¾åŠäº†ç²‰ä¸è§é¢ä¼š', effect: { fans: 2000, money: 2000 } },
            { type: 'bad', title: 'æ¶æ„æŠ•è¯‰', desc: 'æœ‰äººæ¶æ„æŠ•è¯‰ä½ çš„ç›´æ’­', effect: { warnings: 1 } },
            { type: 'good', title: 'å¹³å°æ¨è', desc: 'å¹³å°ç»™ä½ æä¾›äº†æ¨èä½', effect: { views: 40000, fans: 4000 } },
            { type: 'bad', title: 'ç®—æ³•è°ƒæ•´', desc: 'å¹³å°ç®—æ³•è°ƒæ•´ï¼Œæµé‡ä¸‹é™', effect: { views: -15000 } },
            { type: 'good', title: 'ç—…æ¯’ä¼ æ’­', desc: 'ä½ çš„è§†é¢‘æˆä¸ºç—…æ¯’å¼ä¼ æ’­', effect: { views: 100000, fans: 10000 } },
            { type: 'bad', title: 'ç‰ˆæƒäº‰è®®', desc: 'ä½ çš„è§†é¢‘æ¶‰åŠç‰ˆæƒé—®é¢˜', effect: { warnings: 2, views: -5000 } }
        ];

        // è¿è§„å…³é”®è¯
        const violationKeywords = ['æš´åŠ›', 'è‰²æƒ…', 'æ”¿æ²»', 'è°£è¨€', 'è¯ˆéª—', 'ç›—ç‰ˆ', 'ä¾µæƒ', 'è¾±éª‚', 'æ­§è§†', 'æ¯’å“'];

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åŠ è½½å­˜æ¡£
            const saved = localStorage.getItem('streamerGameState');
            if (saved) {
                gameState = JSON.parse(saved);
                if (gameState.isBanned) {
                    showBannedPage();
                    return;
                }
            }
            
            // ç”Ÿæˆç”¨æˆ·ID
            if (!gameState.userId) {
                gameState.userId = 'UID' + Math.random().toString(36).substr(2, 9).toUpperCase();
            }
            
            // åˆå§‹åŒ–å›¾è¡¨æ•°æ®
            if (gameState.chartData.fans.length === 0) {
                for (let i = 0; i < 20; i++) {
                    gameState.chartData.fans.push(0);
                    gameState.chartData.likes.push(0);
                    gameState.chartData.views.push(0);
                }
            }
            
            updateDisplay();
            startWorkUpdates();
            startGameLoop();
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('è¯·è¾“å…¥ä½ çš„åå­—');
                return;
            }
            
            gameState.username = username;
            gameState.avatar = username.charAt(0).toUpperCase();
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'flex';
            
            initGame();
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('usernameDisplay').textContent = gameState.username;
            document.getElementById('userAvatar').textContent = gameState.avatar;
            document.getElementById('fansCount').textContent = formatNumber(gameState.fans);
            document.getElementById('likesCount').textContent = formatNumber(gameState.likes);
            document.getElementById('viewsCount').textContent = formatNumber(gameState.views);
            document.getElementById('worksCount').textContent = gameState.works;
            document.getElementById('moneyCount').textContent = formatNumber(gameState.money);
            document.getElementById('warningCount').textContent = `${gameState.warnings}/10`;
            
            // æ›´æ–°ç›´æ’­æŒ‰é’®çŠ¶æ€
            const liveBtn = document.getElementById('liveControlBtn');
            if (liveBtn) {
                liveBtn.style.display = gameState.liveStatus ? 'block' : 'none';
                liveBtn.style.background = gameState.liveStatus ? '#ff0050' : '#00f2ea';
                liveBtn.textContent = gameState.liveStatus ? 'â¹ï¸' : 'ğŸ“±';
            }
            
            // æ›´æ–°ä½œå“åˆ—è¡¨
            updateWorksList();
            
            // æ£€æŸ¥æˆå°±
            checkAchievements();
            
            // ä¿å­˜å­˜æ¡£
            saveGame();
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 100000000) {
                return (num / 100000000).toFixed(1) + 'äº¿';
            } else if (num >= 10000) {
                return (num / 10000).toFixed(1) + 'ä¸‡';
            } else {
                return num.toString();
            }
        }

        // æ›´æ–°ä½œå“åˆ—è¡¨ï¼ˆå¸¦å®æ—¶æ•°æ®ï¼‰
        function updateWorksList() {
            const worksList = document.getElementById('worksList');
            worksList.innerHTML = '';
            
            // åªæ˜¾ç¤ºæœ€æ–°çš„5ä¸ªä½œå“
            const recentWorks = gameState.worksList.slice(-5).reverse();
            
            recentWorks.forEach((work, index) => {
                const workItem = document.createElement('div');
                workItem.className = 'work-item';
                workItem.innerHTML = `
                    <div class="work-header">
                        <span class="work-type">${work.type === 'video' ? 'ğŸ¬ è§†é¢‘' : 'ğŸ“ åŠ¨æ€'}</span>
                        <span class="work-time">${formatTime(work.time)}</span>
                    </div>
                    <div class="work-content">${work.content}</div>
                    <div class="work-stats">
                        <span>â–¶ï¸ <span class="stat-number" id="work-views-${work.id}">${work.views}</span></span>
                        <span>â¤ï¸ <span class="stat-number" id="work-likes-${work.id}">${work.likes}</span></span>
                        <span>ğŸ’¬ <span class="stat-number" id="work-comments-${work.id}">${work.comments}</span></span>
                        <span>ğŸ”„ <span class="stat-number" id="work-shares-${work.id}">${work.shares}</span></span>
                    </div>
                `;
                workItem.onclick = () => showWorkDetail(work);
                worksList.appendChild(workItem);
            });
            
            if (recentWorks.length === 0) {
                worksList.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">è¿˜æ²¡æœ‰ä½œå“ï¼Œå¿«å»åˆ›ä½œå§ï¼</div>';
            }
        }

        // å¼€å§‹ä½œå“æ•°æ®å®æ—¶æ›´æ–°
        function startWorkUpdates() {
            // æ¯3ç§’æ›´æ–°ä¸€æ¬¡ä½œå“æ•°æ®
            setInterval(() => {
                if (gameState.isBanned || gameState.worksList.length === 0) return;
                
                gameState.worksList.forEach(work => {
                    // éšæœºå¢é•¿
                    const viewsGrowth = Math.floor(Math.random() * 50);
                    const likesGrowth = Math.floor(Math.random() * 20);
                    const commentsGrowth = Math.floor(Math.random() * 10);
                    const sharesGrowth = Math.floor(Math.random() * 5);
                    
                    work.views += viewsGrowth;
                    work.likes += likesGrowth;
                    work.comments += commentsGrowth;
                    work.shares += sharesGrowth;
                    
                    // æ›´æ–°æ˜¾ç¤º
                    const viewsEl = document.getElementById(`work-views-${work.id}`);
                    const likesEl = document.getElementById(`work-likes-${work.id}`);
                    const commentsEl = document.getElementById(`work-comments-${work.id}`);
                    const sharesEl = document.getElementById(`work-shares-${work.id}`);
                    
                    if (viewsEl) {
                        viewsEl.textContent = work.views;
                        animateNumberUpdate(viewsEl);
                    }
                    if (likesEl) {
                        likesEl.textContent = work.likes;
                        animateNumberUpdate(likesEl);
                    }
                    if (commentsEl) {
                        commentsEl.textContent = work.comments;
                        animateNumberUpdate(commentsEl);
                    }
                    if (sharesEl) {
                        sharesEl.textContent = work.shares;
                        animateNumberUpdate(sharesEl);
                    }
                    
                    // æ›´æ–°æ€»æ•°æ®
                    gameState.views += viewsGrowth;
                    gameState.likes += likesGrowth;
                });
                
                updateDisplay();
            }, 3000);
        }

        // æ•°å­—æ›´æ–°åŠ¨ç”»
        function animateNumberUpdate(element) {
            element.classList.add('updating');
            setTimeout(() => {
                element.classList.remove('updating');
            }, 300);
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'åˆšåˆš';
            if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
            if (minutes < 1440) return `${Math.floor(minutes / 60)}å°æ—¶å‰`;
            return `${Math.floor(minutes / 1440)}å¤©å‰`;
        }

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modal').style.display = 'block';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // å‘å¸ƒè§†é¢‘
        function showCreateVideo() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">å‘å¸ƒè§†é¢‘</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div class="input-group">
                    <div class="input-label">è§†é¢‘æ ‡é¢˜</div>
                    <input type="text" class="text-input" id="videoTitle" placeholder="ç»™ä½ çš„è§†é¢‘èµ·ä¸ªæ ‡é¢˜" maxlength="50">
                </div>
                <div class="input-group">
                    <div class="input-label">è§†é¢‘å†…å®¹</div>
                    <textarea class="text-input" id="videoContent" rows="4" placeholder="æè¿°ä½ çš„è§†é¢‘å†…å®¹" maxlength="200"></textarea>
                </div>
                <button class="btn" onclick="createVideo()">å‘å¸ƒè§†é¢‘</button>
            `;
            showModal(content);
        }

        // åˆ›å»ºè§†é¢‘
        function createVideo() {
            const title = document.getElementById('videoTitle').value.trim();
            const content = document.getElementById('videoContent').value.trim();
            
            if (!title || !content) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            // æ£€æŸ¥è¿è§„
            if (checkViolation(title + content)) {
                return;
            }
            
            // ç”Ÿæˆéšæœºæ•°æ®
            const views = Math.floor(Math.random() * 10000) + 1000;
            const likes = Math.floor(views * (Math.random() * 0.1 + 0.01));
            const comments = Math.floor(likes * (Math.random() * 0.3 + 0.1));
            const shares = Math.floor(likes * (Math.random() * 0.2 + 0.05));
            
            const work = {
                id: Date.now(),
                type: 'video',
                title: title,
                content: content,
                views: views,
                likes: likes,
                comments: comments,
                shares: shares,
                time: Date.now(),
                revenue: Math.floor(views / 1000)
            };
            
            gameState.worksList.push(work);
            gameState.works++;
            gameState.views += views;
            gameState.likes += likes;
            gameState.money += work.revenue;
            
            // éšæœºæ¶¨ç²‰
            const newFans = Math.floor(views / 1000 * (Math.random() * 2 + 0.5));
            gameState.fans += newFans;
            
            closeModal();
            updateDisplay();
            showNotification('è§†é¢‘å‘å¸ƒæˆåŠŸï¼', `è·å¾—${views}æ’­æ”¾é‡ï¼Œ${newFans}æ–°ç²‰ä¸`);
        }

        // å‘å¸ƒåŠ¨æ€
        function showCreatePost() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">å‘å¸ƒåŠ¨æ€</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div class="input-group">
                    <div class="input-label">åŠ¨æ€å†…å®¹</div>
                    <textarea class="text-input" id="postContent" rows="6" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..." maxlength="500"></textarea>
                </div>
                <button class="btn" onclick="createPost()">å‘å¸ƒåŠ¨æ€</button>
            `;
            showModal(content);
        }

        // åˆ›å»ºåŠ¨æ€
        function createPost() {
            const content = document.getElementById('postContent').value.trim();
            
            if (!content) {
                alert('è¯·è¾“å…¥åŠ¨æ€å†…å®¹');
                return;
            }
            
            // æ£€æŸ¥è¿è§„
            if (checkViolation(content)) {
                return;
            }
            
            // ç”Ÿæˆéšæœºæ•°æ®
            const views = Math.floor(Math.random() * 5000) + 500;
            const likes = Math.floor(views * (Math.random() * 0.15 + 0.02));
            const comments = Math.floor(likes * (Math.random() * 0.4 + 0.15));
            const shares = Math.floor(likes * (Math.random() * 0.3 + 0.1));
            
            const work = {
                id: Date.now(),
                type: 'post',
                content: content,
                views: views,
                likes: likes,
                comments: comments,
                shares: shares,
                time: Date.now()
            };
            
            gameState.worksList.push(work);
            gameState.works++;
            gameState.views += views;
            gameState.likes += likes;
            
            // éšæœºæ¶¨ç²‰
            const newFans = Math.floor(views / 2000 * (Math.random() * 1.5 + 0.3));
            gameState.fans += newFans;
            
            closeModal();
            updateDisplay();
            showNotification('åŠ¨æ€å‘å¸ƒæˆåŠŸï¼', `è·å¾—${views}æµè§ˆï¼Œ${newFans}æ–°ç²‰ä¸`);
        }

        // æ£€æŸ¥è¿è§„
        function checkViolation(content) {
            const hasViolation = violationKeywords.some(keyword => content.includes(keyword));
            
            if (hasViolation) {
                gameState.warnings++;
                showWarning(`å†…å®¹åŒ…å«è¿è§„ä¿¡æ¯ï¼Œè­¦å‘Š${gameState.warnings}/10æ¬¡`);
                
                if (gameState.warnings >= 10) {
                    banAccount('å¤šæ¬¡è¿åç¤¾åŒºè§„å®š');
                }
                
                return true;
            }
            
            return false;
        }

        // æ˜¾ç¤ºè­¦å‘Š
        function showWarning(message) {
            const toast = document.getElementById('warningToast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // å°å·
        function banAccount(reason) {
            gameState.isBanned = true;
            gameState.banEndTime = Date.now() + 24 * 60 * 60 * 1000; // 24å°æ—¶
            
            saveGame();
            showBannedPage();
        }

        // æ˜¾ç¤ºå°å·é¡µé¢
        function showBannedPage() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('bannedPage').style.display = 'flex';
            document.getElementById('bannedReason').textContent = gameState.banReason || 'è¿åç¤¾åŒºè§„å®š';
            document.getElementById('bannedTime').textContent = gameState.banEndTime ? 
                `å°ç¦è‡³ï¼š${new Date(gameState.banEndTime).toLocaleString()}` : 'å°ç¦æ—¶é—´ï¼šæ°¸ä¹…';
        }

        // ç”³è¯‰
        function appealBan() {
            if (Math.random() > 0.3) { // 70%æˆåŠŸç‡
                gameState.isBanned = false;
                gameState.banEndTime = null;
                gameState.warnings = Math.max(0, gameState.warnings - 5);
                
                alert('ç”³è¯‰æˆåŠŸï¼è´¦å·å·²è§£å°');
                document.getElementById('bannedPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'flex';
                
                saveGame();
                updateDisplay();
            } else {
                alert('ç”³è¯‰å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ç›´æ’­æ§åˆ¶
        function toggleLive() {
            if (gameState.liveStatus) {
                endLive();
            } else {
                startLive();
            }
        }

        // å¼€å§‹ç›´æ’­
        function startLive() {
            if (gameState.liveStatus) {
                showNotification('æç¤º', 'ä½ æ­£åœ¨ç›´æ’­ä¸­');
                return;
            }
            
            gameState.liveStatus = true;
            document.getElementById('liveControlBtn').style.display = 'block';
            
            const content = `
                <div class="live-container">
                    <div class="live-header">
                        <div>
                            <div style="font-size:16px;font-weight:bold">${gameState.username}çš„ç›´æ’­é—´</div>
                            <div style="font-size:12px;color:#999">ç›´æ’­åˆ†ç±»ï¼šå¨±ä¹</div>
                        </div>
                        <div class="live-viewers">ğŸ‘¥ 0</div>
                    </div>
                    <div class="live-content">
                        <div class="live-avatar">${gameState.avatar}</div>
                    </div>
                    <div class="live-controls">
                        <button class="live-btn live-btn-start" onclick="startLiveStream()">å¼€å§‹ç›´æ’­</button>
                        <button class="live-btn live-btn-end" onclick="endLiveStream()">ç»“æŸç›´æ’­</button>
                    </div>
                </div>
            `;
            showModal(content);
        }

        // ç»“æŸç›´æ’­
        function endLive() {
            endLiveStream();
        }

        // å¼€å§‹ç›´æ’­æµ
        function startLiveStream() {
            let viewers = Math.floor(Math.random() * 1000) + 100;
            let liveTime = 0;
            
            gameState.liveInterval = setInterval(() => {
                if (!gameState.liveStatus) {
                    clearInterval(gameState.liveInterval);
                    return;
                }
                
                liveTime++;
                viewers += Math.floor(Math.random() * 100) - 50;
                viewers = Math.max(50, viewers);
                
                // æ›´æ–°è§‚çœ‹äººæ•°
                const viewersElement = document.querySelector('.live-viewers');
                if (viewersElement) {
                    viewersElement.textContent = `ğŸ‘¥ ${viewers}`;
                }
                
                // éšæœºæ¶¨ç²‰
                if (Math.random() < 0.1) {
                    const newFans = Math.floor(Math.random() * 10) + 1;
                    gameState.fans += newFans;
                    gameState.money += newFans * 0.1; // ç¤¼ç‰©æ”¶ç›Š
                }
                
                // æ¯30ç§’æ›´æ–°ä¸€æ¬¡æ˜¾ç¤º
                if (liveTime % 30 === 0) {
                    updateDisplay();
                }
            }, 1000);
            
            showNotification('ç›´æ’­å¼€å§‹', 'ç¥ä½ ç›´æ’­é¡ºåˆ©ï¼');
        }

        // ç»“æŸç›´æ’­æµ
        function endLiveStream() {
            gameState.liveStatus = false;
            if (gameState.liveInterval) {
                clearInterval(gameState.liveInterval);
            }
            closeModal();
            updateDisplay();
            showNotification('ç›´æ’­ç»“æŸ', 'è¾›è‹¦äº†ï¼');
        }

        // æ˜¾ç¤ºå›¾è¡¨
        function showCharts() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">æ•°æ®åˆ†æ</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div class="chart-container">
                    <div class="chart-item">
                        <div class="chart-header">
                            <div class="chart-title">ç²‰ä¸å¢é•¿è¶‹åŠ¿</div>
                            <div class="chart-value">${gameState.fans}</div>
                        </div>
                        <canvas class="chart-canvas" id="fansChart"></canvas>
                    </div>
                    <div class="chart-item">
                        <div class="chart-header">
                            <div class="chart-title">ç‚¹èµå¢é•¿è¶‹åŠ¿</div>
                            <div class="chart-value">${gameState.likes}</div>
                        </div>
                        <canvas class="chart-canvas" id="likesChart"></canvas>
                    </div>
                    <div class="chart-item">
                        <div class="chart-header">
                            <div class="chart-title">æ’­æ”¾å¢é•¿è¶‹åŠ¿</div>
                            <div class="chart-value">${gameState.views}</div>
                        </div>
                        <canvas class="chart-canvas" id="viewsChart"></canvas>
                    </div>
                </div>
            `;
            showModal(content);
            
            // ç»˜åˆ¶å›¾è¡¨
            setTimeout(() => {
                drawChart('fansChart', gameState.chartData.fans, '#667eea');
                drawChart('likesChart', gameState.chartData.likes, '#ff0050');
                drawChart('viewsChart', gameState.chartData.views, '#00f2ea');
            }, 100);
        }

        // ç»˜åˆ¶å›¾è¡¨
        function drawChart(canvasId, data, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            const maxValue = Math.max(...data, 1);
            const step = width / (data.length - 1);
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = (height / 4) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶æ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, color + '40');
            gradient.addColorStop(1, color + '10');
            
            // ç»˜åˆ¶å¡«å……åŒºåŸŸ
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.moveTo(0, height);
            
            data.forEach((value, index) => {
                const x = index * step;
                const y = height - (value / maxValue) * height;
                ctx.lineTo(x, y);
            });
            
            ctx.lineTo(width, height);
            ctx.closePath();
            ctx.fill();
            
            // ç»˜åˆ¶æŠ˜çº¿
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = index * step;
                const y = height - (value / maxValue) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // ç»˜åˆ¶æ•°æ®ç‚¹
            ctx.fillStyle = color;
            data.forEach((value, index) => {
                const x = index * step;
                const y = height - (value / maxValue) * height;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // æ˜¾ç¤ºè®¾ç½®
        function showSettings() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">è´¦å·è®¾ç½®</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div class="settings-item" onclick="changeUsername()">
                    <div>
                        <div class="settings-label">ä¿®æ”¹æ˜µç§°</div>
                        <div class="settings-value">${gameState.username}</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="changeUserId()">
                    <div>
                        <div class="settings-label">ç”¨æˆ·ID</div>
                        <div class="settings-value">${gameState.userId}</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="changeAvatar()">
                    <div>
                        <div class="settings-label">ä¿®æ”¹å¤´åƒ</div>
                        <div class="settings-value">ç‚¹å‡»ä¿®æ”¹</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="showProfile()">
                    <div>
                        <div class="settings-label">ä¸ªäººä¸»é¡µ</div>
                        <div class="settings-value">æŸ¥çœ‹ä¸»é¡µ</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="clearData()" style="background:#ff0050">
                    <div class="settings-label">æ¸…é™¤æ•°æ®</div>
                    <div class="settings-value">è°¨æ…æ“ä½œ</div>
                </div>
            `;
            showModal(content);
        }

        // ä¿®æ”¹ç”¨æˆ·å
        function changeUsername() {
            const newName = prompt('è¯·è¾“å…¥æ–°æ˜µç§°ï¼ˆæœ€å¤š10ä¸ªå­—ç¬¦ï¼‰', gameState.username);
            if (newName && newName.trim()) {
                gameState.username = newName.trim().substring(0, 10);
                gameState.avatar = gameState.username.charAt(0).toUpperCase();
                updateDisplay();
                showNotification('ä¿®æ”¹æˆåŠŸ', 'æ˜µç§°å·²æ›´æ–°');
            }
        }

        // ä¿®æ”¹ç”¨æˆ·ID
        function changeUserId() {
            const newId = prompt('è¯·è¾“å…¥æ–°IDï¼ˆæœ€å¤š20ä¸ªå­—ç¬¦ï¼‰', gameState.userId);
            if (newId && newId.trim()) {
                gameState.userId = newId.trim().substring(0, 20);
                showNotification('ä¿®æ”¹æˆåŠŸ', 'IDå·²æ›´æ–°');
            }
        }

        // ä¿®æ”¹å¤´åƒ
        function changeAvatar() {
            const avatar = prompt('è¯·è¾“å…¥å¤´åƒæ–‡å­—ï¼ˆ1ä¸ªå­—ç¬¦ï¼‰', gameState.avatar);
            if (avatar && avatar.trim()) {
                gameState.avatar = avatar.trim().substring(0, 1);
                updateDisplay();
                showNotification('ä¿®æ”¹æˆåŠŸ', 'å¤´åƒå·²æ›´æ–°');
            }
        }

        // æ¸…é™¤æ•°æ®
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('streamerGameState');
                location.reload();
            }
        }

        // æ˜¾ç¤ºä¸ªäººä¸»é¡µ
        function showProfile() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">ä¸ªäººä¸»é¡µ</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div style="text-align:center;padding:20px">
                    <div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 10px">${gameState.avatar}</div>
                    <div style="font-size:20px;font-weight:bold;margin-bottom:5px">${gameState.username}</div>
                    <div style="font-size:14px;color:#999;margin-bottom:20px">${gameState.userId}</div>
                    <div style="display:flex;justify-content:space-around;margin-bottom:20px">
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${gameState.fans}</div>
                            <div style="font-size:12px;color:#999">ç²‰ä¸</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${gameState.works}</div>
                            <div style="font-size:12px;color:#999">ä½œå“</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${gameState.likes}</div>
                            <div style="font-size:12px;color:#999">è·èµ</div>
                        </div>
                    </div>
                    <button class="btn" onclick="showAllWorks()">æŸ¥çœ‹æ‰€æœ‰ä½œå“</button>
                </div>
            `;
            showModal(content);
        }

        // æ˜¾ç¤ºæ‰€æœ‰ä½œå“
        function showAllWorks() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">æ‰€æœ‰ä½œå“</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div style="max-height:60vh;overflow-y:auto">
                    ${gameState.worksList.map(work => `
                        <div class="work-item" onclick="showWorkDetail(${JSON.stringify(work).replace(/"/g, '&quot;')})">
                            <div class="work-header">
                                <span class="work-type">${work.type === 'video' ? 'ğŸ¬ è§†é¢‘' : 'ğŸ“ åŠ¨æ€'}</span>
                                <span class="work-time">${formatTime(work.time)}</span>
                            </div>
                            <div class="work-content">${work.content}</div>
                            <div class="work-stats">
                                <span>â–¶ï¸ ${work.views}</span>
                                <span>â¤ï¸ ${work.likes}</span>
                                <span>ğŸ’¬ ${work.comments}</span>
                                <span>ğŸ”„ ${work.shares}</span>
                            </div>
                        </div>
                    `).join('')}
                    ${gameState.worksList.length === 0 ? '<div style="text-align:center;color:#999;padding:20px;">è¿˜æ²¡æœ‰ä½œå“</div>' : ''}
                </div>
            `;
            showModal(content);
        }

        // æ˜¾ç¤ºä½œå“è¯¦æƒ…
        function showWorkDetail(work) {
            // ç”Ÿæˆéšæœºè¯„è®º
            const comments = generateComments(work.comments);
            
            const content = `
                <div class="modal-header">
                    <div class="modal-title">${work.type === 'video' ? 'è§†é¢‘è¯¦æƒ…' : 'åŠ¨æ€è¯¦æƒ…'}</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div style="margin-bottom:20px">
                    <div style="font-size:16px;margin-bottom:10px">${work.content}</div>
                    <div style="font-size:12px;color:#999;margin-bottom:15px">${formatTime(work.time)}</div>
                    <div style="display:flex;justify-content:space-around;padding:15px;background:#161823;border-radius:10px;margin-bottom:20px">
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.views}</div>
                            <div style="font-size:12px;color:#999">æ’­æ”¾</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.likes}</div>
                            <div style="font-size:12px;color:#999">ç‚¹èµ</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.comments}</div>
                            <div style="font-size:12px;color:#999">è¯„è®º</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.shares}</div>
                            <div style="font-size:12px;color:#999">è½¬å‘</div>
                        </div>
                    </div>
                    <div style="margin-bottom:10px;font-weight:bold">è¯„è®ºåŒº</div>
                    <div id="commentsList">
                        ${comments.map(comment => `
                            <div class="comment-item">
                                <div class="comment-header">
                                    <span class="comment-user">${comment.user}</span>
                                    <span class="comment-time">${comment.time}</span>
                                </div>
                                <div class="comment-content">${comment.content}</div>
                                <div class="comment-actions">
                                    <span class="comment-action">ğŸ‘ ${comment.likes}</span>
                                    <span class="comment-action">å›å¤</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            showModal(content);
        }

        // ç”Ÿæˆè¯„è®º
        function generateComments(count) {
            const comments = [];
            const users = ['å°å¯çˆ±123', 'ç›´æ’­è¾¾äºº', 'è·¯äººç”²', 'ç²‰ä¸ä¸€å·', 'åƒç“œç¾¤ä¼—', 'çƒ­å¿ƒç½‘å‹', 'åŒ¿åç”¨æˆ·', 'å¤œçŒ«å­'];
            const contents = [
                'å¤ªæ£’äº†ï¼', 'æ”¯æŒä¸»æ’­ï¼', '666', 'æ‹å¾—çœŸå¥½', 'æ¥äº†æ¥äº†', 'å‰æ’å›´è§‚', 'ä¸»æ’­è¾›è‹¦äº†', 'åŠ æ²¹åŠ æ²¹',
                'å¾ˆå¥½çœ‹', 'ä¸é”™ä¸é”™', 'å­¦ä¹ äº†', 'æ”¶è—äº†', 'è½¬å‘æ”¯æŒ', 'æœŸå¾…æ›´æ–°', 'ä¸»æ’­æœ€ç¾', 'æœ€æ£’çš„ä¸»æ’­',
                'ä»Šå¤©çŠ¶æ€çœŸå¥½', 'è¿™ä¸ªå†…å®¹æœ‰æ„æ€', 'è®²å¾—å¾ˆè¯¦ç»†', 'å—ç›ŠåŒªæµ…', 'ä¸»æ’­äººçœŸå¥½', 'äº’åŠ¨å¾ˆæ£’', 'ç›´æ’­å¾ˆæœ‰è¶£'
            ];
            
            const commentCount = Math.min(count, 20); // æœ€å¤šæ˜¾ç¤º20æ¡
            
            for (let i = 0; i < commentCount; i++) {
                comments.push({
                    user: users[Math.floor(Math.random() * users.length)] + Math.floor(Math.random() * 999),
                    content: contents[Math.floor(Math.random() * contents.length)],
                    likes: Math.floor(Math.random() * 100),
                    time: `${Math.floor(Math.random() * 60)}åˆ†é’Ÿå‰`
                });
            }
            
            return comments;
        }

        // æ˜¾ç¤ºæˆå°±
        function showAchievements() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">æˆå°±ç³»ç»Ÿ</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div style="max-height:60vh;overflow-y:auto">
                    ${achievements.map(achievement => `
                        <div class="achievement-item">
                            <div class="achievement-icon ${achievement.unlocked ? 'unlocked' : ''}">
                                ${achievement.icon}
                            </div>
                            <div class="achievement-info">
                                <div class="achievement-name">${achievement.name}</div>
                                <div class="achievement-desc">${achievement.desc}</div>
                            </div>
                            <div style="color:${achievement.unlocked ? '#667eea' : '#999'};font-size:12px">
                                ${achievement.unlocked ? 'å·²è§£é”' : 'æœªè§£é”'}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            showModal(content);
        }

        // æ£€æŸ¥æˆå°±
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked) {
                    let unlocked = false;
                    
                    switch (achievement.id) {
                        case 1: unlocked = gameState.fans >= 1; break;
                        case 2: unlocked = gameState.fans >= 1000; break;
                        case 3: unlocked = gameState.fans >= 100000; break;
                        case 4: unlocked = gameState.fans >= 10000000; break;
                        case 5: unlocked = gameState.worksList.some(w => w.views >= 1000000); break;
                        case 6: unlocked = gameState.likes >= 100000; break;
                        case 7: unlocked = gameState.works >= 100; break;
                        case 8: unlocked = gameState.worksList.some(w => w.type === 'live' && w.views >= 1000); break;
                        case 9: unlocked = gameState.money >= 1; break;
                        case 10: unlocked = gameState.money >= 1000000; break;
                        case 11: unlocked = gameState.worksList.some(w => w.shares >= 10000); break;
                        case 12: unlocked = gameState.worksList.some(w => w.comments >= 5000); break;
                        case 13: unlocked = (Date.now() - gameState.gameStartTime) >= 30 * 24 * 60 * 60 * 1000; break;
                        case 14: unlocked = false; // ç‰¹æ®Šå¤„ç†ï¼Œåœ¨ç”³è¯‰æˆåŠŸæ—¶è§£é”
                        case 15: unlocked = gameState.notifications.length >= 50; break;
                        case 16: unlocked = false; // å…³æ³¨åŠŸèƒ½æœªå®ç°
                        case 17: unlocked = false; // æ—¶é—´æ£€æµ‹
                        case 18: unlocked = false; // æ—¶é—´æ£€æµ‹
                        case 19: unlocked = false; // å›å¤åŠŸèƒ½æœªå®ç°
                        case 20: unlocked = achievements.filter(a => a.unlocked).length >= 19; break;
                    }
                    
                    if (unlocked) {
                        achievement.unlocked = true;
                        gameState.achievements.push(achievement.id);
                        showNotification('æˆå°±è§£é”ï¼', `${achievement.name}ï¼š${achievement.desc}`);
                    }
                }
            });
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(title, content) {
            const notification = {
                id: Date.now(),
                title: title,
                content: content,
                time: Date.now(),
                read: false
            };
            
            gameState.notifications.push(notification);
            updateNotificationBadge();
        }

        // æ›´æ–°é€šçŸ¥å¾½ç« 
        function updateNotificationBadge() {
            const unreadCount = gameState.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥åˆ—è¡¨
        function showNotifications() {
            // æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»
            gameState.notifications.forEach(n => n.read = true);
            updateNotificationBadge();
            
            const content = `
                <div class="modal-header">
                    <div class="modal-title">é€šçŸ¥ä¸­å¿ƒ</div>
                    <div class="close-btn" onclick="closeModal()">âœ•</div>
                </div>
                <div style="max-height:60vh;overflow-y:auto">
                    ${gameState.notifications.length === 0 ? 
                        '<div style="text-align:center;color:#999;padding:20px;">æš‚æ— é€šçŸ¥</div>' :
                        gameState.notifications.slice(-20).reverse().map(notification => `
                            <div class="comment-item">
                                <div class="comment-header">
                                    <span class="comment-user">${notification.title}</span>
                                    <span class="comment-time">${formatTime(notification.time)}</span>
                                </div>
                                <div class="comment-content">${notification.content}</div>
                            </div>
                        `).join('')
                    }
                </div>
            `;
            showModal(content);
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            
            // æ ¹æ®æ ‡ç­¾æ›´æ–°å†…å®¹
            const content = document.getElementById('mainContent');
            
            switch (tab) {
                case 'home':
                    location.reload(); // ç®€å•çš„è¿”å›é¦–é¡µ
                    break;
                case 'works':
                    showAllWorks();
                    break;
                case 'messages':
                    showNotifications();
                    break;
                case 'achievements':
                    showAchievements();
                    break;
            }
        }

        // æ¸¸æˆå¾ªç¯
        function startGameLoop() {
            // æ¯0.1ç§’æ›´æ–°æ•°æ®
            setInterval(() => {
                if (gameState.isBanned) return;
                
                // æ›´æ–°å›¾è¡¨æ•°æ®
                if (Math.random() < 0.1) { // 10%æ¦‚ç‡æ›´æ–°
                    updateChartData();
                }
                
                // éšæœºæ¶¨ç²‰æˆ–æ‰ç²‰
                if (Math.random() < 0.05) { // 5%æ¦‚ç‡
                    const change = Math.floor(Math.random() * 100) - 50;
                    gameState.fans = Math.max(0, gameState.fans + change);
                    
                    if (change > 0) {
                        showNotification('ç²‰ä¸å˜åŒ–', `è·å¾—äº†${change}ä¸ªæ–°ç²‰ä¸`);
                    } else if (change < 0) {
                        showNotification('ç²‰ä¸å˜åŒ–', `å¤±å»äº†${Math.abs(change)}ä¸ªç²‰ä¸`);
                    }
                }
                
                // æ›´æ–°æ˜¾ç¤º
                updateDisplay();
            }, 100);
            
            // æ¯30ç§’è§¦å‘éšæœºäº‹ä»¶
            setInterval(() => {
                if (gameState.isBanned) return;
                
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                handleRandomEvent(event);
            }, 30000);
            
            // æ¯åˆ†é’Ÿæ£€æŸ¥æ‰ç²‰
            setInterval(() => {
                if (gameState.isBanned) return;
                
                // é•¿æ—¶é—´ä¸æ›´æ–°ä¼šæ‰ç²‰
                const timeSinceLastUpdate = Date.now() - gameState.lastUpdateTime;
                if (timeSinceLastUpdate > 10 * 60 * 1000) { // 10åˆ†é’Ÿ
                    const loss = Math.floor(gameState.fans * 0.01); // æ‰1%ç²‰ä¸
                    gameState.fans = Math.max(0, gameState.fans - loss);
                    
                    if (loss > 0) {
                        showNotification('ç²‰ä¸æµå¤±', `ç”±äºé•¿æ—¶é—´æœªæ›´æ–°ï¼Œå¤±å»äº†${loss}ä¸ªç²‰ä¸`);
                    }
                }
            }, 60000);
        }

        // å¤„ç†éšæœºäº‹ä»¶
        function handleRandomEvent(event) {
            // åº”ç”¨æ•ˆæœ
            if (event.effect.fans) gameState.fans = Math.max(0, gameState.fans + event.effect.fans);
            if (event.effect.likes) gameState.likes = Math.max(0, gameState.likes + event.effect.likes);
            if (event.effect.views) gameState.views = Math.max(0, gameState.views + event.effect.views);
            if (event.effect.money) gameState.money = Math.max(0, gameState.money + event.effect.money);
            if (event.effect.warnings) gameState.warnings += event.effect.warnings;
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(event.title, event.desc);
            
            // æ£€æŸ¥å°å·
            if (gameState.warnings >= 10) {
                banAccount('å¤šæ¬¡è¿åç¤¾åŒºè§„å®š');
            }
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®
        function updateChartData() {
            // ç§»é™¤ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œæ·»åŠ æ–°æ•°æ®
            gameState.chartData.fans.shift();
            gameState.chartData.fans.push(gameState.fans);
            
            gameState.chartData.likes.shift();
            gameState.chartData.likes.push(gameState.likes);
            
            gameState.chartData.views.shift();
            gameState.chartData.views.push(gameState.views);
        }

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('streamerGameState', JSON.stringify(gameState));
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('modal').onclick = function(e) {
                if (e.target === this) {
                    closeModal();
                }
            };
        };
    </script>
</body>
</html>
