<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>字体播放展示</title>
<style>
html,body{margin:0;padding:20px;background:#fff;color:#000;font-family:sans-serif}
#top{margin-bottom:12px;font-size:18px}
#progress-wrap{height:24px;background:#ddd;border-radius:12px;overflow:hidden}
#progress{height:100%;background:#28a745;width:0%;transition:width .2s}
#grid{display:flex;flex-wrap:wrap;gap:12px;margin-top:20px}
.cell{
    width:120px;height:120px;border:2px solid #ccc;border-radius:6px;
    display:flex;align-items:center;justify-content:center;font-size:32px;
    background:#fafafa;
}
.cell.done{color:#666;font-style:italic;font-size:16px}
</style>
<style id="font-decl"></style>
</head>
<body>

<div id="top">Unicode 数量：<span id="counter">0</span></div>
<div id="progress-wrap"><div id="progress"></div></div>
<div id="grid"></div>

<script>
/* ===== 1. 字体文件顺序 ===== */
const files = [
    'DroidSansFallback.ttf','CtrlMath-1.otf','EmojiIcon.ttf','font.ttf','KanaExt.otf',
    'Medium.ttf','MonuHani-9.5.otf','MonuHanp-3.111.ttf','MonuLast-8.12.ttf','MonuTemp-0.920.ttf',
    'NotoColorEmoji.ttf','NotoSansAdlam-Regular.ttf','NotoUnicode-7.2-Medium.otf','NotoUnicodeOne.ttf',
    "pIqaD-qolqoS.ttf",'PlangothicP1-Regular.fallback.ttf','PlangothicP2-Regular.ttf',
    'PrivateUseSelectors.ttf','unifont_csur-15.0.01.otf'
];

/* ===== 2. 动态注入 @font-face ===== */
const decl = document.getElementById('font-decl');
files.forEach((f,i)=>{
    decl.sheet.insertRule(`
        @font-face{
            font-family:'F${i}';
            src:url('${f.replace(/'/g,"\\'")}');
        }
    `,decl.sheet.cssRules.length);
});

/* ===== 3. 创建 19 个格子 ===== */
const grid = document.getElementById('grid');
const cells = [];
files.forEach((_,i)=>{
    const c = document.createElement('div');
    c.className = 'cell'; c.id = `c${i}`;
    c.style.fontFamily = `'F${i}'`;
    grid.appendChild(c);
    cells.push(c);
});

/* ===== 4. 播放核心 ===== */
const START = 0x0020, END = 0xFFFF;
const TOTAL_CHARS = END - START + 1;
let maxUnicode = START - 1;          // 全局已播到的最大 Unicode
const progressBar = document.getElementById('progress');
const counterBox  = document.getElementById('counter');

/* 更新进度条与数字 */
function updateProgress(){
    const ratio = (maxUnicode - START + 1) / TOTAL_CHARS;
    progressBar.style.width = (ratio * 100).toFixed(2) + '%';
    counterBox.textContent = maxUnicode;
}

class Player {
    constructor(idx){
        this.idx  = idx;
        this.code = START;
        this.timer= null;
    }
    start(){
        this.timer = setInterval(()=>{
            if(this.code > END){
                clearInterval(this.timer);
                cells[this.idx].textContent = '播放完毕';
                cells[this.idx].classList.add('done');
                return;
            }
            cells[this.idx].textContent = String.fromCharCode(this.code);
            // 更新全局最大值
            if(this.code > maxUnicode){
                maxUnicode = this.code;
                updateProgress();
            }
            this.code++;
        },1);
    }
}

/* ===== 5. 等待所有字体加载完成再同时播放 ===== */
let loaded = 0;
files.forEach((_,i)=>{
    const probe = new FontFace(`F${i}`, `url('${files[i].replace(/'/g,"\\'")}')`);
    probe.load().then(()=>{
        loaded++;
        if(loaded === files.length){
            /* 全部到位，同时开播 */
            cells.forEach((_,i)=>new Player(i).start());
        }
    });
});
</script>
</body>
</html>
