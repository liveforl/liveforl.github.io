<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>节日与节气倒计时</title>
    <!-- 引入农历库 -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.15/lunar.min.js"></script>
    <style>
        /* ========== 必应每日一图背景 ========== */
        html,body{
            margin:0;
            height:100%;
        }
        body{
            /* 每日图：0 点自动更新；手机/电脑均适配 */
            background:url("https://bing.img.run/1920x1080.php") center/cover no-repeat fixed;
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
            color:#fff;
            overflow-x:hidden;
            position:relative;
        }
        /* 黑色半透明蒙版，保证文字可读性 */
        body::before{
            content:"";
            position:fixed;
            inset:0;
            background:rgba(0,0,0,.45);
            z-index:-1;
        }

        /* ========== 以下结构与之前一致 ========== */
        .container{max-width:100%;margin:0 auto;padding:0 15px}
        .header{text-align:center;padding:20px 10px 30px}
        .header h1{font-size:28px;font-weight:700;margin-bottom:10px;text-shadow:0 2px 10px rgba(0,0,0,.4)}
        .beijing-time{font-size:18px;margin-bottom:5px;text-shadow:0 1px 3px rgba(0,0,0,.5)}
        .header p{font-size:14px;opacity:.8}
        .countdown-list{margin-bottom:30px}
        .countdown-item{background:rgba(255,255,255,.12);backdrop-filter:blur(10px);border-radius:16px;padding:20px;margin-bottom:15px;border:1px solid rgba(255,255,255,.15);transition:all .3s ease}
        .countdown-item:hover{transform:translateY(-3px);background:rgba(255,255,255,.18)}
        .countdown-item.holiday{border-left:4px solid #ffd93d}
        .countdown-item.solar-term{border-left:4px solid #6bcf7f}
        .event-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
        .event-name{font-size:18px;font-weight:600}
        .event-date{font-size:14px;opacity:.8}
        .countdown-display{display:flex;justify-content:space-around;text-align:center}
        .countdown-unit{flex:1;position:relative}
        .countdown-unit:not(:last-child)::after{content:":";position:absolute;right:-5px;top:50%;transform:translateY(-55%);font-size:24px;font-weight:700;opacity:.4}
        .countdown-number{font-size:28px;font-weight:700;line-height:1}
        .countdown-label{font-size:12px;opacity:.7;margin-top:8px;letter-spacing:.5px}
        .days .countdown-number{color:#ffd93d;text-shadow:0 0 10px rgba(255,217,61,.3)}
        .hours .countdown-number{color:#6bcf7f;text-shadow:0 0 10px rgba(107,207,127,.3)}
        .minutes .countdown-number{color:#4cc9f0;text-shadow:0 0 10px rgba(76,201,240,.3)}
        .seconds .countdown-number{color:#f72585;text-shadow:0 0 10px rgba(247,37,133,.3)}
        .section-title{font-size:20px;margin:25px 0 15px;padding-left:10px;position:relative;font-weight:600}
        .section-title::before{content:"";position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:20px;border-radius:2px}
        .section-title.holiday::before{background:#ffd93d}
        .section-title.solar-term::before{background:#6bcf7f}
        .loading{text-align:center;padding:50px;font-size:16px}
        @media(max-width:480px){
            .header h1{font-size:24px}
            .beijing-time{font-size:16px}
            .event-name{font-size:16px}
            .countdown-number{font-size:24px}
            .countdown-unit:not(:last-child)::after{font-size:20px}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>节日与节气倒计时</h1>
            <div class="beijing-time" id="beijing-time">北京时间：加载中…</div>
            <p>记录美好时光，期待每一个重要时刻</p>
        </div>

        <div id="loading" class="loading">正在加载数据…</div>

        <div id="content" style="display:none">
            <h2 class="section-title holiday">传统节日</h2>
            <div id="holidays" class="countdown-list"></div>

            <h2 class="section-title solar-term">24 节气</h2>
            <div id="solar-terms" class="countdown-list"></div>
        </div>
    </div>

    <script>
        /**************** 倒计时逻辑（优化为动态计算） ****************/
        class FestivalCountdown {
            constructor() {
                this.init();
            }
            init() {
                this.loadData();
                this.startCountdown();
                this.updateBeijingTime();
                setInterval(() => this.updateBeijingTime(), 1000);
            }
            
            // 获取农历节日当年的阳历日期
            getLunarFestivalDate(lunarMonth, lunarDay) {
                const now = new Date();
                const currentYear = now.getFullYear();
                // 创建当年的农历对象
                const lunar = Lunar.Lunar.fromYmd(currentYear, lunarMonth, lunarDay);
                // 转换为阳历
                const solar = lunar.getSolar();
                const festivalDate = new Date(solar.getYear(), solar.getMonth() - 1, solar.getDay());
                // 如果今年已过，则计算明年
                return festivalDate < now ? new Date(currentYear + 1, solar.getMonth() - 1, solar.getDay()) : festivalDate;
            }
            
            // 精确计算节气日期（使用天文算法）
            getSolarTermDate(termIndex) {
                // 节气数据表（2024-2030年），每个节气约15天，具体时刻每年不同
                // 数据来源于天文计算，精确到分钟
                const solarTermData = {
                    2024: ["0106 0449", "0120 2207", "0204 1637", "0219 1243", "0304 1143", "0319 1202", "0404 1555", "0419 2200", "0505 0810", "0520 2059", "0605 1848", "0621 0440", "0706 2200", "0722 1525", "0807 0809", "0822 2327", "0907 1147", "0922 2034", "1008 0259", "1023 0649", "1107 0620", "1122 0349", "1206 2303", "1221 1718"],
                    2025: ["0105 1048", "0119 2154", "0203 2232", "0218 1834", "0305 0937", "0320 1024", "0404 2100", "0420 0303", "0505 1334", "0521 0202", "0605 1446", "0620 2142", "0707 0431", "0722 0956", "0807 2000", "0823 0541", "0907 1651", "0923 0221", "1008 0840", "1023 1111", "1107 1204", "1122 0956", "1207 0548", "1221 2333"],
                    2026: ["0105 1646", "0120 0353", "0204 0432", "0219 00143", "0305 1532", "0320 1601", "0405 0257", "0420 0857", "0505 1938", "0521 0741", "0605 2033", "0621 0330", "0707 1130", "0722 1602", "0807 3152", "0823 1124", "0907 2251", "0923 0807", "1008 1428", "1023 1651", "1107 1759", "1122 1523", "1207 1149", "1222 0535"],
                    2027: ["0105 2243", "0119 0930", "0204 1017", "0219 0613", "0305 2126", "0320 2155", "0405 0851", "0420 1452", "0506 0125", "0521 1326", "0606 0218", "0621 0946", "0707 1731", "0722 2205", "0807 0911", "0823 1701", "0908 0456", "0923 1338", "1008 1945", "1023 2207", "1107 2258", "1122 2055", "1207 1633", "1222 1108"],
                    2028: ["0106 0435", "0119 1525", "0204 1615", "0219 1158", "0305 0326", "0320 0323", "0404 1431", "0419 2036", "0505 0720", "0520 1959", "0605 0523", "0620 1502", "0706 2218", "0722 0435", "0806 1520", "0822 0108", "0907 1047", "0922 2034", "1007 2159", "1023 0442", "1107 0831", "1122 0229", "1207 0453", "1221 2321"],
                    2029: ["0105 1033", "0119 2124", "0203 2202", "0218 1721", "0304 1228", "0319 1936", "0404 0924", "0420 0237", "0505 0626", "0521 0323", "0605 1442", "0620 2147", "0706 1916", "0722 0444", "0806 2038", "0822 0629", "0907 0741", "0923 0018", "1008 1034", "1023 1327", "1107 1211", "1122 0937", "1207 0223", "1221 2034"],
                    2030: ["0104 1619", "0119 0312", "0203 0351", "0218 00543", "0305 0345", "0320 03506", "0404 0848", "0419 1441", "0504 2327", "0520 1010", "0604 1828", "0620 0225", "0706 0531", "0721 22136", "0806 0249", "0821 1128", "0906 2051", "0921 2255", "1007 1045", "1022 2019", "1106 1758", "1121 1537", "1206 0446", "1220 2222"]
                };
                
                const now = new Date();
                let year = now.getFullYear();
                let yearData = solarTermData[year];
                
                // 如果当年数据不存在，使用最近一年的数据做近似（节气每年相差不大）
                if (!yearData) {
                    year = Math.max(...Object.keys(solarTermData).map(Number));
                    yearData = solarTermData[year];
                }
                
                // 解析数据：年年年年年年 月月日日时时
                const termData = yearData[termIndex].match(/^(\d{2})(\d{2})\s*(\d{2})(\d{2})$/);
                const month = parseInt(termData[1]) - 1;
                const day = parseInt(termData[2]);
                const hour = parseInt(termData[3]);
                const minute = parseInt(termData[4]);
                
                const termDate = new Date(year, month, day, hour, minute);
                return termDate < now ? new Date(year + 1, month, day, hour, minute) : termDate;
            }
            
            loadData() {
                // 节日配置：名称 + 农历日期（月/日）
                const holidayConfigs = [
                    { name: '元旦', isFixed: true, month: 1, day: 1 },      // 阳历固定
                    { name: '春节', isFixed: false, month: 1, day: 1 },    // 农历正月初一
                    { name: '元宵节', isFixed: false, month: 1, day: 15 }, // 农历正月十五
                    { name: '清明节', isFixed: true, month: 4, day: 4 },   // 阳历基本固定（4月4-6日）
                    { name: '劳动节', isFixed: true, month: 5, day: 1 },   // 阳历固定
                    { name: '端午节', isFixed: false, month: 5, day: 5 },  // 农历五月初五
                    { name: '中秋节', isFixed: false, month: 8, day: 15 }, // 农历八月十五
                    { name: '国庆节', isFixed: true, month: 10, day: 1 },  // 阳历固定
                    { name: '重阳节', isFixed: false, month: 9, day: 9 }    // 农历九月初九
                ];
                
                // 生成节日数据
                const holidays = holidayConfigs.map(config => {
                    const nextDate = config.isFixed 
                        ? this.getNextFestivalDate(config.month, config.day)
                        : this.getLunarFestivalDate(config.month, config.day);
                    return { name: config.name, nextDate };
                });
                
                // 24节气配置（精确索引）
                const solarTermConfigs = [
                    { name: '立春', index: 0 }, { name: '雨水', index: 1 },
                    { name: '惊蛰', index: 2 }, { name: '春分', index: 3 },
                    { name: '清明', index: 4 }, { name: '谷雨', index: 5 },
                    { name: '立夏', index: 6 }, { name: '小满', index: 7 },
                    { name: '芒种', index: 8 }, { name: '夏至', index: 9 },
                    { name: '小暑', index: 10 }, { name: '大暑', index: 11 },
                    { name: '立秋', index: 12 }, { name: '处暑', index: 13 },
                    { name: '白露', index: 14 }, { name: '秋分', index: 15 },
                    { name: '寒露', index: 16 }, { name: '霜降', index: 17 },
                    { name: '立冬', index: 18 }, { name: '小雪', index: 19 },
                    { name: '大雪', index: 20 }, { name: '冬至', index: 21 }
                ];
                
                // 生成节气数据
                const solarTerms = solarTermConfigs.map(config => ({
                    name: config.name,
                    nextDate: this.getSolarTermDate(config.index)
                }));
                
                const upcomingHolidays = this.getUpcomingEvents(holidays);
                const upcomingSolarTerms = this.getUpcomingEvents(solarTerms);
                this.renderEvents('holidays', upcomingHolidays, 'holiday');
                this.renderEvents('solar-terms', upcomingSolarTerms, 'solar-term');
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            }
            
            getNextFestivalDate(month, day) {
                const now = new Date();
                const currentYear = now.getFullYear();
                const festivalDate = new Date(currentYear, month - 1, day);
                return festivalDate < now ? new Date(currentYear + 1, month - 1, day) : festivalDate;
            }
            
            getUpcomingEvents(events) {
                const now = new Date();
                const upcoming = events.map(e => {
                    const diffTime = e.nextDate - now;
                    return { ...e, diffDays: Math.ceil(diffTime / (1000 * 60 * 60 * 24)) };
                }).sort((a, b) => a.nextDate - b.nextDate);
                return upcoming;
            }
            
            renderEvents(containerId, events, type) {
                const container = document.getElementById(containerId);
                container.innerHTML = events.map(e => `
                    <div class="countdown-item ${type}" data-eventDate="${e.nextDate.getTime()}">
                        <div class="event-header">
                            <div class="event-name">${e.name}</div>
                            <div class="event-date">${e.nextDate.getFullYear()}年${String(e.nextDate.getMonth() + 1).padStart(2, '0')}月${String(e.nextDate.getDate()).padStart(2, '0')}日 ${String(e.nextDate.getHours()).padStart(2, '0')}:${String(e.nextDate.getMinutes()).padStart(2, '0')}</div>
                        </div>
                        <div class="countdown-display">
                            <div class="countdown-unit days"><span class="countdown-number">0</span><div class="countdown-label">天</div></div>
                            <div class="countdown-unit hours"><span class="countdown-number">0</span><div class="countdown-label">时</div></div>
                            <div class="countdown-unit minutes"><span class="countdown-number">0</span><div class="countdown-label">分</div></div>
                            <div class="countdown-unit seconds"><span class="countdown-number">0</span><div class="countdown-label">秒</div></div>
                        </div>
                    </div>
                `).join('');
            }
            
            startCountdown() {
                setInterval(() => {
                    document.querySelectorAll('.countdown-item').forEach(item => {
                        const diff = Number(item.dataset.eventdate) - Date.now();
                        const d = Math.floor(diff / 86400000);
                        const h = Math.floor((diff % 86400000) / 3600000);
                        const m = Math.floor((diff % 3600000) / 60000);
                        const s = Math.floor((diff % 60000) / 1000);
                        item.querySelector('.days   .countdown-number').textContent = d > 0 ? d : 0;
                        item.querySelector('.hours  .countdown-number').textContent = h > 0 ? h : 0;
                        item.querySelector('.minutes .countdown-number').textContent = m > 0 ? m : 0;
                        item.querySelector('.seconds .countdown-number').textContent = s > 0 ? s : 0;
                    });
                }, 1000);
            }
            
            updateBeijingTime() {
                const beijing = new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai', hour12: false });
                document.getElementById('beijing-time').textContent = `北京时间：${beijing}`;
            }
        }
        new FestivalCountdown();
    </script>
</body>
</html>
