<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>主播模拟器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 登录页面 */
        #loginPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-window {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .login-title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-btn:active {
            transform: scale(0.98);
        }

        /* 主页面 */
        #mainPage {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        /* 顶部导航 */
        .header {
            background: #161823;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        .header-title {
            font-size: 18px;
            font-weight: bold;
        }

        .header-right {
            display: flex;
            gap: 15px;
        }

        .header-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff0050;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            min-width: 16px;
            text-align: center;
        }

        /* 内容区域 */
        .content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 60px;
        }

        /* 统计卡片 */
        .stats-card {
            background: #161823;
            margin: 10px;
            padding: 15px;
            border-radius: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
        }

        /* 操作按钮 */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 10px;
        }

        .action-btn {
            background: #161823;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:active {
            transform: scale(0.98);
            background: #222;
        }

        .action-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .action-text {
            font-size: 14px;
            color: #ccc;
        }

        /* 作品列表 */
        .works-section {
            padding: 10px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .work-item {
            background: #161823;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .work-item:active {
            background: #222;
        }

        .work-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .work-type {
            background: #667eea;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
        }

        .work-time {
            font-size: 12px;
            color: #999;
        }

        .work-content {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .work-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
        }

        .stat-number {
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .stat-number.updating {
            color: #00f2ea;
            transform: scale(1.1);
        }

        /* 底部导航 */
        .bottom-nav {
            background: #161823;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .nav-text {
            font-size: 10px;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: #161823;
            margin: 20px;
            border-radius: 15px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        /* 输入框 */
        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }

        .text-input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* 按钮 */
        .btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #333;
        }

        .btn-danger {
            background: #ff0050;
        }

        /* 直播页面 */
        .live-container {
            background: #000;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .live-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .live-viewers {
            background: rgba(255, 0, 80, 0.8);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .live-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .live-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .live-controls {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            display: flex;
            gap: 15px;
        }

        .live-btn {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .live-btn-start {
            background: #00f2ea;
            color: #000;
        }

        .live-btn-end {
            background: #ff0050;
            color: white;
        }

        /* 图表页面 - 仿抖音风格 */
        .chart-container {
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
        }

        .chart-item {
            background: #161823;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            color: #fff;
        }

        .chart-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .chart-canvas {
            width: 100%;
            height: 200px;
            background: #222;
            border-radius: 8px;
        }

        /* 设置页面 */
        .settings-item {
            background: #161823;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .settings-item:active {
            background: #222;
        }

        .settings-label {
            font-size: 14px;
        }

        .settings-value {
            font-size: 14px;
            color: #999;
        }

        /* 成就页面 */
        .achievement-item {
            background: #161823;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .achievement-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .achievement-icon.unlocked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-desc {
            font-size: 12px;
            color: #999;
        }

        /* 评论列表 */
        .comment-item {
            background: #161823;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-user {
            font-size: 14px;
            font-weight: bold;
        }

        .comment-time {
            font-size: 12px;
            color: #999;
        }

        .comment-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
        }

        .comment-action {
            cursor: pointer;
            transition: color 0.3s;
        }

        .comment-action:active {
            color: #667eea;
        }

        /* 警告提示 */
        .warning-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff0050;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 2000;
            display: none;
        }

        /* 封号页面 */
        .banned-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #000;
            padding: 20px;
            text-align: center;
        }

        .banned-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .banned-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .banned-reason {
            font-size: 14px;
            color: #999;
            margin-bottom: 20px;
        }

        .banned-time {
            font-size: 16px;
            color: #ff0050;
            margin-bottom: 30px;
        }

        /* 直播控制按钮 */
        .live-control-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: ${props.isLive ? '#ff0050' : '#00f2ea'};
            color: ${props.isLive ? 'white' : 'black'};
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            z-index: 99;
        }

        .live-control-btn:active {
            transform: scale(0.95);
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #161823;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* 响应式设计 */
        @media (max-width: 375px) {
            .stats-card {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- 登录页面 -->
    <div id="loginPage">
        <div class="login-window">
            <div class="login-title">主播模拟器</div>
            <input type="text" class="login-input" id="usernameInput" placeholder="请输入你的名字" maxlength="20">
            <button class="login-btn" onclick="startGame()">确定</button>
        </div>
    </div>

    <!-- 主页面 -->
    <div id="mainPage">
        <!-- 顶部导航 -->
        <div class="header">
            <div class="header-left">
                <div class="avatar" id="userAvatar" onclick="showProfile()">A</div>
                <div class="header-title" id="usernameDisplay">主播</div>
            </div>
            <div class="header-right">
                <div class="header-icon" onclick="showNotifications()">
                    🔔
                    <span class="notification-badge" id="notificationBadge" style="display:none">0</span>
                </div>
                <div class="header-icon" onclick="showSettings()">⚙️</div>
            </div>
        </div>

        <!-- 内容区域 -->
        <div class="content" id="mainContent">
            <!-- 统计卡片 -->
            <div class="stats-card">
                <div class="stat-item">
                    <div class="stat-value" id="fansCount">0</div>
                    <div class="stat-label">粉丝</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="likesCount">0</div>
                    <div class="stat-label">点赞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="viewsCount">0</div>
                    <div class="stat-label">播放</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="worksCount">0</div>
                    <div class="stat-label">作品</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="moneyCount">0</div>
                    <div class="stat-label">零钱</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="warningCount">0/10</div>
                    <div class="stat-label">警告</div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="action-buttons">
                <div class="action-btn" onclick="showCreateVideo()">
                    <div class="action-icon">🎬</div>
                    <div class="action-text">发布视频</div>
                </div>
                <div class="action-btn" onclick="showCreatePost()">
                    <div class="action-icon">📝</div>
                    <div class="action-text">发布动态</div>
                </div>
                <div class="action-btn" onclick="startLive()">
                    <div class="action-icon">📱</div>
                    <div class="action-text">开始直播</div>
                </div>
                <div class="action-btn" onclick="showCharts()">
                    <div class="action-icon">📊</div>
                    <div class="action-text">数据分析</div>
                </div>
            </div>

            <!-- 作品列表 -->
            <div class="works-section">
                <div class="section-title">
                    <span>我的作品</span>
                    <span style="font-size:12px;color:#999" id="updateTime">刚刚更新</span>
                </div>
                <div id="worksList"></div>
            </div>
        </div>

        <!-- 底部导航 -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')">
                <div class="nav-icon">🏠</div>
                <div class="nav-text">首页</div>
            </div>
            <div class="nav-item" onclick="switchTab('works')">
                <div class="nav-icon">📹</div>
                <div class="nav-text">作品</div>
            </div>
            <div class="nav-item" onclick="switchTab('messages')">
                <div class="nav-icon">💬</div>
                <div class="nav-text">消息</div>
            </div>
            <div class="nav-item" onclick="switchTab('achievements')">
                <div class="nav-icon">🏆</div>
                <div class="nav-text">成就</div>
            </div>
        </div>

        <!-- 直播控制按钮 -->
        <button class="live-control-btn" id="liveControlBtn" onclick="toggleLive()" style="display:none">
            📱
        </button>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- 警告提示 -->
    <div class="warning-toast" id="warningToast"></div>

    <!-- 封号页面 -->
    <div class="banned-container" id="bannedPage">
        <div class="banned-icon">🚫</div>
        <div class="banned-title">账号被封禁</div>
        <div class="banned-reason" id="bannedReason">违反社区规定</div>
        <div class="banned-time" id="bannedTime">封禁时间：永久</div>
        <button class="btn" onclick="appealBan()">申诉</button>
    </div>

    <script>
        // 游戏状态
        let gameState = {
            username: '',
            userId: '',
            avatar: '',
            fans: 0,
            likes: 0,
            views: 0,
            works: 0,
            money: 0,
            warnings: 0,
            isBanned: false,
            banEndTime: null,
            achievements: [],
            worksList: [],
            notifications: [],
            liveStatus: false,
            lastUpdateTime: Date.now(),
            gameStartTime: Date.now(),
            chartData: {
                fans: [],
                likes: [],
                views: []
            },
            liveInterval: null,
            workUpdateIntervals: []
        };

        // 成就列表
        const achievements = [
            { id: 1, name: '初入江湖', desc: '获得第一个粉丝', icon: '🌱', unlocked: false },
            { id: 2, name: '小有名气', desc: '粉丝达到1000', icon: '🌟', unlocked: false },
            { id: 3, name: '网红达人', desc: '粉丝达到10万', icon: '⭐', unlocked: false },
            { id: 4, name: '顶级流量', desc: '粉丝达到1000万', icon: '🌟', unlocked: false },
            { id: 5, name: '爆款制造机', desc: '单条视频播放量破百万', icon: '🔥', unlocked: false },
            { id: 6, name: '点赞狂魔', desc: '累计获得10万个赞', icon: '👍', unlocked: false },
            { id: 7, name: '高产创作者', desc: '发布100个作品', icon: '📹', unlocked: false },
            { id: 8, name: '直播新星', desc: '首次直播获得1000观看', icon: '📱', unlocked: false },
            { id: 9, name: '收益第一桶金', desc: '获得首次收益', icon: '💰', unlocked: false },
            { id: 10, name: '百万富翁', desc: '累计收益达到100万', icon: '💎', unlocked: false },
            { id: 11, name: '话题之王', desc: '单条动态获得1万转发', icon: '🔁', unlocked: false },
            { id: 12, name: '评论互动达人', desc: '单条作品获得5000评论', icon: '💬', unlocked: false },
            { id: 13, name: '全勤主播', desc: '连续30天更新', icon: '📅', unlocked: false },
            { id: 14, name: '逆风翻盘', desc: '从封号中申诉成功', icon: '🔄', unlocked: false },
            { id: 15, name: '幸运儿', desc: '触发50次随机事件', icon: '🍀', unlocked: false },
            { id: 16, name: '社交达人', desc: '关注1000个用户', icon: '👥', unlocked: false },
            { id: 17, name: '夜猫子', desc: '凌晨3点还在直播', icon: '🦉', unlocked: false },
            { id: 18, name: '早起鸟儿', desc: '早上6点开始直播', icon: '🐦', unlocked: false },
            { id: 19, name: '宠粉狂魔', desc: '回复1000条评论', icon: '💝', unlocked: false },
            { id: 20, name: '传奇主播', desc: '解锁所有成就', icon: '👑', unlocked: false }
        ];

        // 随机事件
        const randomEvents = [
            { type: 'good', title: '视频爆了！', desc: '你的视频被推荐到首页，播放量暴涨', effect: { views: 50000, fans: 5000, likes: 3000 } },
            { type: 'good', title: '话题热搜', desc: '你的动态登上热搜榜', effect: { views: 20000, fans: 2000, likes: 1500 } },
            { type: 'good', title: '大V转发', desc: '知名博主转发了你的作品', effect: { views: 30000, fans: 3000, likes: 2000 } },
            { type: 'good', title: '粉丝福利', desc: '粉丝们给你刷了礼物', effect: { money: 1000, likes: 500 } },
            { type: 'good', title: '品牌合作', desc: '有品牌找你合作推广', effect: { money: 5000, fans: 1000 } },
            { type: 'bad', title: '内容争议', desc: '你的内容引发争议，有人举报', effect: { fans: -500, warnings: 1 } },
            { type: 'bad', title: '黑粉攻击', desc: '有人组织黑粉攻击你的账号', effect: { fans: -1000, likes: -500 } },
            { type: 'bad', title: '系统误判', desc: '系统误判你的内容违规', effect: { warnings: 1 } },
            { type: 'bad', title: '竞争对手', desc: '同类型主播抢走了你的流量', effect: { views: -10000, fans: -800 } },
            { type: 'bad', title: '网络暴力', desc: '你被网暴了，心情低落', effect: { fans: -300, likes: -200 } },
            { type: 'neutral', title: '平淡一天', desc: '今天没什么特别的事情发生', effect: {} },
            { type: 'neutral', title: '粉丝互动', desc: '和粉丝们聊得很开心', effect: { likes: 100 } },
            { type: 'neutral', title: '灵感枯竭', desc: '今天没有创作灵感', effect: {} },
            { type: 'good', title: '技能提升', desc: '你学会了新的剪辑技巧', effect: { views: 5000 } },
            { type: 'good', title: '设备升级', desc: '你购买了新的直播设备', effect: { fans: 800 } },
            { type: 'bad', title: '设备故障', desc: '直播设备出现故障', effect: { fans: -200 } },
            { type: 'good', title: '粉丝见面会', desc: '举办了粉丝见面会', effect: { fans: 2000, money: 2000 } },
            { type: 'bad', title: '恶意投诉', desc: '有人恶意投诉你的直播', effect: { warnings: 1 } },
            { type: 'good', title: '平台推荐', desc: '平台给你提供了推荐位', effect: { views: 40000, fans: 4000 } },
            { type: 'bad', title: '算法调整', desc: '平台算法调整，流量下降', effect: { views: -15000 } },
            { type: 'good', title: '病毒传播', desc: '你的视频成为病毒式传播', effect: { views: 100000, fans: 10000 } },
            { type: 'bad', title: '版权争议', desc: '你的视频涉及版权问题', effect: { warnings: 2, views: -5000 } }
        ];

        // 违规关键词
        const violationKeywords = ['暴力', '色情', '政治', '谣言', '诈骗', '盗版', '侵权', '辱骂', '歧视', '毒品'];

        // 初始化游戏
        function initGame() {
            // 加载存档
            const saved = localStorage.getItem('streamerGameState');
            if (saved) {
                gameState = JSON.parse(saved);
                if (gameState.isBanned) {
                    showBannedPage();
                    return;
                }
            }
            
            // 生成用户ID
            if (!gameState.userId) {
                gameState.userId = 'UID' + Math.random().toString(36).substr(2, 9).toUpperCase();
            }
            
            // 初始化图表数据
            if (gameState.chartData.fans.length === 0) {
                for (let i = 0; i < 20; i++) {
                    gameState.chartData.fans.push(0);
                    gameState.chartData.likes.push(0);
                    gameState.chartData.views.push(0);
                }
            }
            
            updateDisplay();
            startWorkUpdates();
            startGameLoop();
        }

        // 开始游戏
        function startGame() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('请输入你的名字');
                return;
            }
            
            gameState.username = username;
            gameState.avatar = username.charAt(0).toUpperCase();
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'flex';
            
            initGame();
        }

        // 更新显示
        function updateDisplay() {
            document.getElementById('usernameDisplay').textContent = gameState.username;
            document.getElementById('userAvatar').textContent = gameState.avatar;
            document.getElementById('fansCount').textContent = formatNumber(gameState.fans);
            document.getElementById('likesCount').textContent = formatNumber(gameState.likes);
            document.getElementById('viewsCount').textContent = formatNumber(gameState.views);
            document.getElementById('worksCount').textContent = gameState.works;
            document.getElementById('moneyCount').textContent = formatNumber(gameState.money);
            document.getElementById('warningCount').textContent = `${gameState.warnings}/10`;
            
            // 更新直播按钮状态
            const liveBtn = document.getElementById('liveControlBtn');
            if (liveBtn) {
                liveBtn.style.display = gameState.liveStatus ? 'block' : 'none';
                liveBtn.style.background = gameState.liveStatus ? '#ff0050' : '#00f2ea';
                liveBtn.textContent = gameState.liveStatus ? '⏹️' : '📱';
            }
            
            // 更新作品列表
            updateWorksList();
            
            // 检查成就
            checkAchievements();
            
            // 保存存档
            saveGame();
        }

        // 格式化数字
        function formatNumber(num) {
            if (num >= 100000000) {
                return (num / 100000000).toFixed(1) + '亿';
            } else if (num >= 10000) {
                return (num / 10000).toFixed(1) + '万';
            } else {
                return num.toString();
            }
        }

        // 更新作品列表（带实时数据）
        function updateWorksList() {
            const worksList = document.getElementById('worksList');
            worksList.innerHTML = '';
            
            // 只显示最新的5个作品
            const recentWorks = gameState.worksList.slice(-5).reverse();
            
            recentWorks.forEach((work, index) => {
                const workItem = document.createElement('div');
                workItem.className = 'work-item';
                workItem.innerHTML = `
                    <div class="work-header">
                        <span class="work-type">${work.type === 'video' ? '🎬 视频' : '📝 动态'}</span>
                        <span class="work-time">${formatTime(work.time)}</span>
                    </div>
                    <div class="work-content">${work.content}</div>
                    <div class="work-stats">
                        <span>▶️ <span class="stat-number" id="work-views-${work.id}">${work.views}</span></span>
                        <span>❤️ <span class="stat-number" id="work-likes-${work.id}">${work.likes}</span></span>
                        <span>💬 <span class="stat-number" id="work-comments-${work.id}">${work.comments}</span></span>
                        <span>🔄 <span class="stat-number" id="work-shares-${work.id}">${work.shares}</span></span>
                    </div>
                `;
                workItem.onclick = () => showWorkDetail(work);
                worksList.appendChild(workItem);
            });
            
            if (recentWorks.length === 0) {
                worksList.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">还没有作品，快去创作吧！</div>';
            }
        }

        // 开始作品数据实时更新
        function startWorkUpdates() {
            // 每3秒更新一次作品数据
            setInterval(() => {
                if (gameState.isBanned || gameState.worksList.length === 0) return;
                
                gameState.worksList.forEach(work => {
                    // 随机增长
                    const viewsGrowth = Math.floor(Math.random() * 50);
                    const likesGrowth = Math.floor(Math.random() * 20);
                    const commentsGrowth = Math.floor(Math.random() * 10);
                    const sharesGrowth = Math.floor(Math.random() * 5);
                    
                    work.views += viewsGrowth;
                    work.likes += likesGrowth;
                    work.comments += commentsGrowth;
                    work.shares += sharesGrowth;
                    
                    // 更新显示
                    const viewsEl = document.getElementById(`work-views-${work.id}`);
                    const likesEl = document.getElementById(`work-likes-${work.id}`);
                    const commentsEl = document.getElementById(`work-comments-${work.id}`);
                    const sharesEl = document.getElementById(`work-shares-${work.id}`);
                    
                    if (viewsEl) {
                        viewsEl.textContent = work.views;
                        animateNumberUpdate(viewsEl);
                    }
                    if (likesEl) {
                        likesEl.textContent = work.likes;
                        animateNumberUpdate(likesEl);
                    }
                    if (commentsEl) {
                        commentsEl.textContent = work.comments;
                        animateNumberUpdate(commentsEl);
                    }
                    if (sharesEl) {
                        sharesEl.textContent = work.shares;
                        animateNumberUpdate(sharesEl);
                    }
                    
                    // 更新总数据
                    gameState.views += viewsGrowth;
                    gameState.likes += likesGrowth;
                });
                
                updateDisplay();
            }, 3000);
        }

        // 数字更新动画
        function animateNumberUpdate(element) {
            element.classList.add('updating');
            setTimeout(() => {
                element.classList.remove('updating');
            }, 300);
        }

        // 格式化时间
        function formatTime(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return '刚刚';
            if (minutes < 60) return `${minutes}分钟前`;
            if (minutes < 1440) return `${Math.floor(minutes / 60)}小时前`;
            return `${Math.floor(minutes / 1440)}天前`;
        }

        // 显示模态框
        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modal').style.display = 'block';
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // 发布视频
        function showCreateVideo() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">发布视频</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div class="input-group">
                    <div class="input-label">视频标题</div>
                    <input type="text" class="text-input" id="videoTitle" placeholder="给你的视频起个标题" maxlength="50">
                </div>
                <div class="input-group">
                    <div class="input-label">视频内容</div>
                    <textarea class="text-input" id="videoContent" rows="4" placeholder="描述你的视频内容" maxlength="200"></textarea>
                </div>
                <button class="btn" onclick="createVideo()">发布视频</button>
            `;
            showModal(content);
        }

        // 创建视频
        function createVideo() {
            const title = document.getElementById('videoTitle').value.trim();
            const content = document.getElementById('videoContent').value.trim();
            
            if (!title || !content) {
                alert('请填写完整信息');
                return;
            }
            
            // 检查违规
            if (checkViolation(title + content)) {
                return;
            }
            
            // 生成随机数据
            const views = Math.floor(Math.random() * 10000) + 1000;
            const likes = Math.floor(views * (Math.random() * 0.1 + 0.01));
            const comments = Math.floor(likes * (Math.random() * 0.3 + 0.1));
            const shares = Math.floor(likes * (Math.random() * 0.2 + 0.05));
            
            const work = {
                id: Date.now(),
                type: 'video',
                title: title,
                content: content,
                views: views,
                likes: likes,
                comments: comments,
                shares: shares,
                time: Date.now(),
                revenue: Math.floor(views / 1000)
            };
            
            gameState.worksList.push(work);
            gameState.works++;
            gameState.views += views;
            gameState.likes += likes;
            gameState.money += work.revenue;
            
            // 随机涨粉
            const newFans = Math.floor(views / 1000 * (Math.random() * 2 + 0.5));
            gameState.fans += newFans;
            
            closeModal();
            updateDisplay();
            showNotification('视频发布成功！', `获得${views}播放量，${newFans}新粉丝`);
        }

        // 发布动态
        function showCreatePost() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">发布动态</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div class="input-group">
                    <div class="input-label">动态内容</div>
                    <textarea class="text-input" id="postContent" rows="6" placeholder="分享你的想法..." maxlength="500"></textarea>
                </div>
                <button class="btn" onclick="createPost()">发布动态</button>
            `;
            showModal(content);
        }

        // 创建动态
        function createPost() {
            const content = document.getElementById('postContent').value.trim();
            
            if (!content) {
                alert('请输入动态内容');
                return;
            }
            
            // 检查违规
            if (checkViolation(content)) {
                return;
            }
            
            // 生成随机数据
            const views = Math.floor(Math.random() * 5000) + 500;
            const likes = Math.floor(views * (Math.random() * 0.15 + 0.02));
            const comments = Math.floor(likes * (Math.random() * 0.4 + 0.15));
            const shares = Math.floor(likes * (Math.random() * 0.3 + 0.1));
            
            const work = {
                id: Date.now(),
                type: 'post',
                content: content,
                views: views,
                likes: likes,
                comments: comments,
                shares: shares,
                time: Date.now()
            };
            
            gameState.worksList.push(work);
            gameState.works++;
            gameState.views += views;
            gameState.likes += likes;
            
            // 随机涨粉
            const newFans = Math.floor(views / 2000 * (Math.random() * 1.5 + 0.3));
            gameState.fans += newFans;
            
            closeModal();
            updateDisplay();
            showNotification('动态发布成功！', `获得${views}浏览，${newFans}新粉丝`);
        }

        // 检查违规
        function checkViolation(content) {
            const hasViolation = violationKeywords.some(keyword => content.includes(keyword));
            
            if (hasViolation) {
                gameState.warnings++;
                showWarning(`内容包含违规信息，警告${gameState.warnings}/10次`);
                
                if (gameState.warnings >= 10) {
                    banAccount('多次违反社区规定');
                }
                
                return true;
            }
            
            return false;
        }

        // 显示警告
        function showWarning(message) {
            const toast = document.getElementById('warningToast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // 封号
        function banAccount(reason) {
            gameState.isBanned = true;
            gameState.banEndTime = Date.now() + 24 * 60 * 60 * 1000; // 24小时
            
            saveGame();
            showBannedPage();
        }

        // 显示封号页面
        function showBannedPage() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('bannedPage').style.display = 'flex';
            document.getElementById('bannedReason').textContent = gameState.banReason || '违反社区规定';
            document.getElementById('bannedTime').textContent = gameState.banEndTime ? 
                `封禁至：${new Date(gameState.banEndTime).toLocaleString()}` : '封禁时间：永久';
        }

        // 申诉
        function appealBan() {
            if (Math.random() > 0.3) { // 70%成功率
                gameState.isBanned = false;
                gameState.banEndTime = null;
                gameState.warnings = Math.max(0, gameState.warnings - 5);
                
                alert('申诉成功！账号已解封');
                document.getElementById('bannedPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'flex';
                
                saveGame();
                updateDisplay();
            } else {
                alert('申诉失败，请稍后重试');
            }
        }

        // 直播控制
        function toggleLive() {
            if (gameState.liveStatus) {
                endLive();
            } else {
                startLive();
            }
        }

        // 开始直播
        function startLive() {
            if (gameState.liveStatus) {
                showNotification('提示', '你正在直播中');
                return;
            }
            
            gameState.liveStatus = true;
            document.getElementById('liveControlBtn').style.display = 'block';
            
            const content = `
                <div class="live-container">
                    <div class="live-header">
                        <div>
                            <div style="font-size:16px;font-weight:bold">${gameState.username}的直播间</div>
                            <div style="font-size:12px;color:#999">直播分类：娱乐</div>
                        </div>
                        <div class="live-viewers">👥 0</div>
                    </div>
                    <div class="live-content">
                        <div class="live-avatar">${gameState.avatar}</div>
                    </div>
                    <div class="live-controls">
                        <button class="live-btn live-btn-start" onclick="startLiveStream()">开始直播</button>
                        <button class="live-btn live-btn-end" onclick="endLiveStream()">结束直播</button>
                    </div>
                </div>
            `;
            showModal(content);
        }

        // 结束直播
        function endLive() {
            endLiveStream();
        }

        // 开始直播流
        function startLiveStream() {
            let viewers = Math.floor(Math.random() * 1000) + 100;
            let liveTime = 0;
            
            gameState.liveInterval = setInterval(() => {
                if (!gameState.liveStatus) {
                    clearInterval(gameState.liveInterval);
                    return;
                }
                
                liveTime++;
                viewers += Math.floor(Math.random() * 100) - 50;
                viewers = Math.max(50, viewers);
                
                // 更新观看人数
                const viewersElement = document.querySelector('.live-viewers');
                if (viewersElement) {
                    viewersElement.textContent = `👥 ${viewers}`;
                }
                
                // 随机涨粉
                if (Math.random() < 0.1) {
                    const newFans = Math.floor(Math.random() * 10) + 1;
                    gameState.fans += newFans;
                    gameState.money += newFans * 0.1; // 礼物收益
                }
                
                // 每30秒更新一次显示
                if (liveTime % 30 === 0) {
                    updateDisplay();
                }
            }, 1000);
            
            showNotification('直播开始', '祝你直播顺利！');
        }

        // 结束直播流
        function endLiveStream() {
            gameState.liveStatus = false;
            if (gameState.liveInterval) {
                clearInterval(gameState.liveInterval);
            }
            closeModal();
            updateDisplay();
            showNotification('直播结束', '辛苦了！');
        }

        // 显示图表
        function showCharts() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">数据分析</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div class="chart-container">
                    <div class="chart-item">
                        <div class="chart-header">
                            <div class="chart-title">粉丝增长趋势</div>
                            <div class="chart-value">${gameState.fans}</div>
                        </div>
                        <canvas class="chart-canvas" id="fansChart"></canvas>
                    </div>
                    <div class="chart-item">
                        <div class="chart-header">
                            <div class="chart-title">点赞增长趋势</div>
                            <div class="chart-value">${gameState.likes}</div>
                        </div>
                        <canvas class="chart-canvas" id="likesChart"></canvas>
                    </div>
                    <div class="chart-item">
                        <div class="chart-header">
                            <div class="chart-title">播放增长趋势</div>
                            <div class="chart-value">${gameState.views}</div>
                        </div>
                        <canvas class="chart-canvas" id="viewsChart"></canvas>
                    </div>
                </div>
            `;
            showModal(content);
            
            // 绘制图表
            setTimeout(() => {
                drawChart('fansChart', gameState.chartData.fans, '#667eea');
                drawChart('likesChart', gameState.chartData.likes, '#ff0050');
                drawChart('viewsChart', gameState.chartData.views, '#00f2ea');
            }, 100);
        }

        // 绘制图表
        function drawChart(canvasId, data, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            const maxValue = Math.max(...data, 1);
            const step = width / (data.length - 1);
            
            // 绘制网格线
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = (height / 4) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // 绘制渐变背景
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, color + '40');
            gradient.addColorStop(1, color + '10');
            
            // 绘制填充区域
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.moveTo(0, height);
            
            data.forEach((value, index) => {
                const x = index * step;
                const y = height - (value / maxValue) * height;
                ctx.lineTo(x, y);
            });
            
            ctx.lineTo(width, height);
            ctx.closePath();
            ctx.fill();
            
            // 绘制折线
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = index * step;
                const y = height - (value / maxValue) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // 绘制数据点
            ctx.fillStyle = color;
            data.forEach((value, index) => {
                const x = index * step;
                const y = height - (value / maxValue) * height;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // 显示设置
        function showSettings() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">账号设置</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div class="settings-item" onclick="changeUsername()">
                    <div>
                        <div class="settings-label">修改昵称</div>
                        <div class="settings-value">${gameState.username}</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="changeUserId()">
                    <div>
                        <div class="settings-label">用户ID</div>
                        <div class="settings-value">${gameState.userId}</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="changeAvatar()">
                    <div>
                        <div class="settings-label">修改头像</div>
                        <div class="settings-value">点击修改</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="showProfile()">
                    <div>
                        <div class="settings-label">个人主页</div>
                        <div class="settings-value">查看主页</div>
                    </div>
                    <div>></div>
                </div>
                <div class="settings-item" onclick="clearData()" style="background:#ff0050">
                    <div class="settings-label">清除数据</div>
                    <div class="settings-value">谨慎操作</div>
                </div>
            `;
            showModal(content);
        }

        // 修改用户名
        function changeUsername() {
            const newName = prompt('请输入新昵称（最多10个字符）', gameState.username);
            if (newName && newName.trim()) {
                gameState.username = newName.trim().substring(0, 10);
                gameState.avatar = gameState.username.charAt(0).toUpperCase();
                updateDisplay();
                showNotification('修改成功', '昵称已更新');
            }
        }

        // 修改用户ID
        function changeUserId() {
            const newId = prompt('请输入新ID（最多20个字符）', gameState.userId);
            if (newId && newId.trim()) {
                gameState.userId = newId.trim().substring(0, 20);
                showNotification('修改成功', 'ID已更新');
            }
        }

        // 修改头像
        function changeAvatar() {
            const avatar = prompt('请输入头像文字（1个字符）', gameState.avatar);
            if (avatar && avatar.trim()) {
                gameState.avatar = avatar.trim().substring(0, 1);
                updateDisplay();
                showNotification('修改成功', '头像已更新');
            }
        }

        // 清除数据
        function clearData() {
            if (confirm('确定要清除所有数据吗？此操作不可恢复！')) {
                localStorage.removeItem('streamerGameState');
                location.reload();
            }
        }

        // 显示个人主页
        function showProfile() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">个人主页</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div style="text-align:center;padding:20px">
                    <div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 10px">${gameState.avatar}</div>
                    <div style="font-size:20px;font-weight:bold;margin-bottom:5px">${gameState.username}</div>
                    <div style="font-size:14px;color:#999;margin-bottom:20px">${gameState.userId}</div>
                    <div style="display:flex;justify-content:space-around;margin-bottom:20px">
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${gameState.fans}</div>
                            <div style="font-size:12px;color:#999">粉丝</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${gameState.works}</div>
                            <div style="font-size:12px;color:#999">作品</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${gameState.likes}</div>
                            <div style="font-size:12px;color:#999">获赞</div>
                        </div>
                    </div>
                    <button class="btn" onclick="showAllWorks()">查看所有作品</button>
                </div>
            `;
            showModal(content);
        }

        // 显示所有作品
        function showAllWorks() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">所有作品</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div style="max-height:60vh;overflow-y:auto">
                    ${gameState.worksList.map(work => `
                        <div class="work-item" onclick="showWorkDetail(${JSON.stringify(work).replace(/"/g, '&quot;')})">
                            <div class="work-header">
                                <span class="work-type">${work.type === 'video' ? '🎬 视频' : '📝 动态'}</span>
                                <span class="work-time">${formatTime(work.time)}</span>
                            </div>
                            <div class="work-content">${work.content}</div>
                            <div class="work-stats">
                                <span>▶️ ${work.views}</span>
                                <span>❤️ ${work.likes}</span>
                                <span>💬 ${work.comments}</span>
                                <span>🔄 ${work.shares}</span>
                            </div>
                        </div>
                    `).join('')}
                    ${gameState.worksList.length === 0 ? '<div style="text-align:center;color:#999;padding:20px;">还没有作品</div>' : ''}
                </div>
            `;
            showModal(content);
        }

        // 显示作品详情
        function showWorkDetail(work) {
            // 生成随机评论
            const comments = generateComments(work.comments);
            
            const content = `
                <div class="modal-header">
                    <div class="modal-title">${work.type === 'video' ? '视频详情' : '动态详情'}</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div style="margin-bottom:20px">
                    <div style="font-size:16px;margin-bottom:10px">${work.content}</div>
                    <div style="font-size:12px;color:#999;margin-bottom:15px">${formatTime(work.time)}</div>
                    <div style="display:flex;justify-content:space-around;padding:15px;background:#161823;border-radius:10px;margin-bottom:20px">
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.views}</div>
                            <div style="font-size:12px;color:#999">播放</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.likes}</div>
                            <div style="font-size:12px;color:#999">点赞</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.comments}</div>
                            <div style="font-size:12px;color:#999">评论</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:18px;font-weight:bold">${work.shares}</div>
                            <div style="font-size:12px;color:#999">转发</div>
                        </div>
                    </div>
                    <div style="margin-bottom:10px;font-weight:bold">评论区</div>
                    <div id="commentsList">
                        ${comments.map(comment => `
                            <div class="comment-item">
                                <div class="comment-header">
                                    <span class="comment-user">${comment.user}</span>
                                    <span class="comment-time">${comment.time}</span>
                                </div>
                                <div class="comment-content">${comment.content}</div>
                                <div class="comment-actions">
                                    <span class="comment-action">👍 ${comment.likes}</span>
                                    <span class="comment-action">回复</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            showModal(content);
        }

        // 生成评论
        function generateComments(count) {
            const comments = [];
            const users = ['小可爱123', '直播达人', '路人甲', '粉丝一号', '吃瓜群众', '热心网友', '匿名用户', '夜猫子'];
            const contents = [
                '太棒了！', '支持主播！', '666', '拍得真好', '来了来了', '前排围观', '主播辛苦了', '加油加油',
                '很好看', '不错不错', '学习了', '收藏了', '转发支持', '期待更新', '主播最美', '最棒的主播',
                '今天状态真好', '这个内容有意思', '讲得很详细', '受益匪浅', '主播人真好', '互动很棒', '直播很有趣'
            ];
            
            const commentCount = Math.min(count, 20); // 最多显示20条
            
            for (let i = 0; i < commentCount; i++) {
                comments.push({
                    user: users[Math.floor(Math.random() * users.length)] + Math.floor(Math.random() * 999),
                    content: contents[Math.floor(Math.random() * contents.length)],
                    likes: Math.floor(Math.random() * 100),
                    time: `${Math.floor(Math.random() * 60)}分钟前`
                });
            }
            
            return comments;
        }

        // 显示成就
        function showAchievements() {
            const content = `
                <div class="modal-header">
                    <div class="modal-title">成就系统</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div style="max-height:60vh;overflow-y:auto">
                    ${achievements.map(achievement => `
                        <div class="achievement-item">
                            <div class="achievement-icon ${achievement.unlocked ? 'unlocked' : ''}">
                                ${achievement.icon}
                            </div>
                            <div class="achievement-info">
                                <div class="achievement-name">${achievement.name}</div>
                                <div class="achievement-desc">${achievement.desc}</div>
                            </div>
                            <div style="color:${achievement.unlocked ? '#667eea' : '#999'};font-size:12px">
                                ${achievement.unlocked ? '已解锁' : '未解锁'}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            showModal(content);
        }

        // 检查成就
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked) {
                    let unlocked = false;
                    
                    switch (achievement.id) {
                        case 1: unlocked = gameState.fans >= 1; break;
                        case 2: unlocked = gameState.fans >= 1000; break;
                        case 3: unlocked = gameState.fans >= 100000; break;
                        case 4: unlocked = gameState.fans >= 10000000; break;
                        case 5: unlocked = gameState.worksList.some(w => w.views >= 1000000); break;
                        case 6: unlocked = gameState.likes >= 100000; break;
                        case 7: unlocked = gameState.works >= 100; break;
                        case 8: unlocked = gameState.worksList.some(w => w.type === 'live' && w.views >= 1000); break;
                        case 9: unlocked = gameState.money >= 1; break;
                        case 10: unlocked = gameState.money >= 1000000; break;
                        case 11: unlocked = gameState.worksList.some(w => w.shares >= 10000); break;
                        case 12: unlocked = gameState.worksList.some(w => w.comments >= 5000); break;
                        case 13: unlocked = (Date.now() - gameState.gameStartTime) >= 30 * 24 * 60 * 60 * 1000; break;
                        case 14: unlocked = false; // 特殊处理，在申诉成功时解锁
                        case 15: unlocked = gameState.notifications.length >= 50; break;
                        case 16: unlocked = false; // 关注功能未实现
                        case 17: unlocked = false; // 时间检测
                        case 18: unlocked = false; // 时间检测
                        case 19: unlocked = false; // 回复功能未实现
                        case 20: unlocked = achievements.filter(a => a.unlocked).length >= 19; break;
                    }
                    
                    if (unlocked) {
                        achievement.unlocked = true;
                        gameState.achievements.push(achievement.id);
                        showNotification('成就解锁！', `${achievement.name}：${achievement.desc}`);
                    }
                }
            });
        }

        // 显示通知
        function showNotification(title, content) {
            const notification = {
                id: Date.now(),
                title: title,
                content: content,
                time: Date.now(),
                read: false
            };
            
            gameState.notifications.push(notification);
            updateNotificationBadge();
        }

        // 更新通知徽章
        function updateNotificationBadge() {
            const unreadCount = gameState.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        // 显示通知列表
        function showNotifications() {
            // 标记所有通知为已读
            gameState.notifications.forEach(n => n.read = true);
            updateNotificationBadge();
            
            const content = `
                <div class="modal-header">
                    <div class="modal-title">通知中心</div>
                    <div class="close-btn" onclick="closeModal()">✕</div>
                </div>
                <div style="max-height:60vh;overflow-y:auto">
                    ${gameState.notifications.length === 0 ? 
                        '<div style="text-align:center;color:#999;padding:20px;">暂无通知</div>' :
                        gameState.notifications.slice(-20).reverse().map(notification => `
                            <div class="comment-item">
                                <div class="comment-header">
                                    <span class="comment-user">${notification.title}</span>
                                    <span class="comment-time">${formatTime(notification.time)}</span>
                                </div>
                                <div class="comment-content">${notification.content}</div>
                            </div>
                        `).join('')
                    }
                </div>
            `;
            showModal(content);
        }

        // 切换标签
        function switchTab(tab) {
            // 更新导航状态
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            
            // 根据标签更新内容
            const content = document.getElementById('mainContent');
            
            switch (tab) {
                case 'home':
                    location.reload(); // 简单的返回首页
                    break;
                case 'works':
                    showAllWorks();
                    break;
                case 'messages':
                    showNotifications();
                    break;
                case 'achievements':
                    showAchievements();
                    break;
            }
        }

        // 游戏循环
        function startGameLoop() {
            // 每0.1秒更新数据
            setInterval(() => {
                if (gameState.isBanned) return;
                
                // 更新图表数据
                if (Math.random() < 0.1) { // 10%概率更新
                    updateChartData();
                }
                
                // 随机涨粉或掉粉
                if (Math.random() < 0.05) { // 5%概率
                    const change = Math.floor(Math.random() * 100) - 50;
                    gameState.fans = Math.max(0, gameState.fans + change);
                    
                    if (change > 0) {
                        showNotification('粉丝变化', `获得了${change}个新粉丝`);
                    } else if (change < 0) {
                        showNotification('粉丝变化', `失去了${Math.abs(change)}个粉丝`);
                    }
                }
                
                // 更新显示
                updateDisplay();
            }, 100);
            
            // 每30秒触发随机事件
            setInterval(() => {
                if (gameState.isBanned) return;
                
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                handleRandomEvent(event);
            }, 30000);
            
            // 每分钟检查掉粉
            setInterval(() => {
                if (gameState.isBanned) return;
                
                // 长时间不更新会掉粉
                const timeSinceLastUpdate = Date.now() - gameState.lastUpdateTime;
                if (timeSinceLastUpdate > 10 * 60 * 1000) { // 10分钟
                    const loss = Math.floor(gameState.fans * 0.01); // 掉1%粉丝
                    gameState.fans = Math.max(0, gameState.fans - loss);
                    
                    if (loss > 0) {
                        showNotification('粉丝流失', `由于长时间未更新，失去了${loss}个粉丝`);
                    }
                }
            }, 60000);
        }

        // 处理随机事件
        function handleRandomEvent(event) {
            // 应用效果
            if (event.effect.fans) gameState.fans = Math.max(0, gameState.fans + event.effect.fans);
            if (event.effect.likes) gameState.likes = Math.max(0, gameState.likes + event.effect.likes);
            if (event.effect.views) gameState.views = Math.max(0, gameState.views + event.effect.views);
            if (event.effect.money) gameState.money = Math.max(0, gameState.money + event.effect.money);
            if (event.effect.warnings) gameState.warnings += event.effect.warnings;
            
            // 显示通知
            showNotification(event.title, event.desc);
            
            // 检查封号
            if (gameState.warnings >= 10) {
                banAccount('多次违反社区规定');
            }
        }

        // 更新图表数据
        function updateChartData() {
            // 移除第一个数据，添加新数据
            gameState.chartData.fans.shift();
            gameState.chartData.fans.push(gameState.fans);
            
            gameState.chartData.likes.shift();
            gameState.chartData.likes.push(gameState.likes);
            
            gameState.chartData.views.shift();
            gameState.chartData.views.push(gameState.views);
        }

        // 保存游戏
        function saveGame() {
            localStorage.setItem('streamerGameState', JSON.stringify(gameState));
        }

        // 页面加载完成后初始化
        window.onload = function() {
            // 点击模态框外部关闭
            document.getElementById('modal').onclick = function(e) {
                if (e.target === this) {
                    closeModal();
                }
            };
        };
    </script>
</body>
</html>
