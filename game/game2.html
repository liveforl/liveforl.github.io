<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç›´æ’­è§‚çœ‹æ¨¡æ‹Ÿå™¨</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
            background:#000;color:#fff;height:100vh;overflow:hidden;
            -webkit-overflow-scrolling:touch;display:flex;flex-direction:column;
        }
        /* è¾“å…¥é¡µ */
        #nameInputPage{
            flex:1;display:flex;align-items:center;justify-content:center;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;
        }
        .name-input-container{
            background:rgba(255,255,255,.1);backdrop-filter:blur(10px);
            border-radius:20px;padding:40px 30px;width:100%;max-width:350px;text-align:center;
        }
        .name-input-container h1{font-size:24px;margin-bottom:30px;color:#fff;}
        .name-input{
            width:100%;padding:15px;border:none;border-radius:10px;font-size:16px;
            background:rgba(255,255,255,.9);margin-bottom:20px;outline:none;
        }
        .start-btn{
            width:100%;padding:15px;border:none;border-radius:10px;font-size:18px;font-weight:bold;
            background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;cursor:pointer;
            transition:transform .2s;
        }
        .start-btn:active{transform:scale(.95);}

        /* ç›´æ’­é—´ */
        #liveRoomPage{flex:1;display:none;flex-direction:column;background:#000;position:relative;}
        /* 16:9 è§†é¢‘åŒº */
        .video-container{
            width:100%;flex:0 0 56.25%;background:#000;position:relative;
        }
        #liveVideo{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;}
        .video-placeholder{
            position:absolute;top:0;left:0;right:0;bottom:0;display:flex;
            align-items:center;justify-content:center;font-size:48px;opacity:.3;background:#222;
        }

        /* é€æ˜èŠå¤©æµ®å±‚ï¼ˆä¸­ä¸‹ï¼‰ */
        .chat-overlay{
            position:absolute;left:0;right:0;bottom:0;height:50%; /* ä¸­ä¸‹éƒ¨åˆ† */
            background:linear-gradient(to top,rgba(0,0,0,.7) 0%,rgba(0,0,0,.4) 60%,transparent 100%);
            display:flex;flex-direction:column;pointer-events:none; /* ä»…å†…éƒ¨å¯ç‚¹å‡» */
        }
        .chat-scroll{
            flex:1;overflow-y:auto;padding:10px 15px;pointer-events:auto;
        }
        .chat-message{
            background:rgba(0,0,0,.55);padding:8px 12px;border-radius:16px;margin-bottom:6px;font-size:14px;
            animation:slideIn .3s;max-width:80%;word-wrap:break-word;
        }
        @keyframes slideIn{from{transform:translateX(-100%);opacity:0;}to{transform:translateX(0);opacity:1;}}
        .chat-username{color:#ffd700;margin-right:5px;}

        /* åº•éƒ¨è¾“å…¥æ  */
        .bottom-bar{
            flex:0 0 auto;background:rgba(0,0,0,.85);padding:10px 15px;
            display:flex;align-items:center;gap:10px;pointer-events:auto;
        }
        .msg-input{
            flex:1;padding:10px 15px;border:none;border-radius:20px;font-size:14px;
            background:rgba(255,255,255,.2);color:#fff;outline:none;
        }
        .send-btn{background:#667eea;color:#fff;border:none;padding:10px 20px;border-radius:20px;font-size:14px;}
        .action-btn{
            background:rgba(255,255,255,.2);color:#fff;border:none;padding:10px 20px;border-radius:25px;font-size:14px;
        }
        .red-packet-btn{background:linear-gradient(135deg,#ff6b6b 0%,#ff8e53 100%);}
        .red-packet-btn.hidden{display:none;}

        /* çº¢åŒ…å¼¹çª— & æ’è¡Œæ¦œ */
        .red-packet-modal,.rank-modal{
            position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);
            display:none;justify-content:center;align-items:center;z-index:1000;
        }
        .red-packet{
            background:linear-gradient(135deg,#ff6b6b 0%,#ff8e53 100%);
            border-radius:20px;padding:40px;text-align:center;animation:bounceIn .5s;width:90%;max-width:350px;
        }
        @keyframes bounceIn{0%{transform:scale(0);}50%{transform:scale(1.1);}100%{transform:scale(1);}}
        .red-packet h2{font-size:24px;margin-bottom:20px;}
        .red-packet-amount{font-size:48px;font-weight:bold;margin:20px 0;color:#ffd700;}
        .close-btn{background:white;color:#ff6b6b;border:none;padding:10px 30px;border-radius:25px;font-size:16px;font-weight:bold;}
        .rank-content{background:#1a1a1a;min-height:100vh;padding:20px;}
        .rank-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;}
        .rank-title{font-size:24px;font-weight:bold;}
        .rank-item{background:rgba(255,255,255,.1);border-radius:15px;padding:15px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;}
        .rank-number{font-size:20px;font-weight:bold;width:30px;text-align:center;}
        .rank-name{flex:1;margin-left:15px;}
        .rank-amount{font-size:18px;font-weight:bold;color:#ffd700;}
        .current-user{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);}
    </style>
</head>
<body>

    <!-- è¾“å…¥åå­— -->
    <div id="nameInputPage">
        <div class="name-input-container">
            <h1>ç›´æ’­è§‚çœ‹æ¨¡æ‹Ÿå™¨</h1>
            <input id="userNameInput" class="name-input" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" maxlength="10">
            <button class="start-btn" onclick="startLive()">å¼€å§‹è§‚çœ‹ç›´æ’­</button>
        </div>
    </div>

    <!-- ç›´æ’­é—´ -->
    <div id="liveRoomPage">
        <!-- 16:9 ç›´æ’­ç”»é¢ -->
        <div class="video-container">
            <video id="liveVideo" autoplay muted></video>
            <div class="video-placeholder" id="videoPlaceholder">ğŸ“¹</div>
        </div>

        <!-- é€æ˜èŠå¤©æµ®å±‚ï¼ˆä¸­ä¸‹ï¼‰ -->
        <div class="chat-overlay">
            <div class="chat-scroll" id="chatScroll">
                <div id="chatContainer"></div>
            </div>
            <!-- åº•éƒ¨è¾“å…¥æ  -->
            <div class="bottom-bar">
                <input id="msgInput" class="msg-input" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." maxlength="30">
                <button class="send-btn" onclick="sendUserMsg()">å‘é€</button>
                <button class="action-btn red-packet-btn" id="redPacketBtn" onclick="grabRedPacket()">æŠ¢çº¢åŒ…</button>
                <button class="action-btn" onclick="showRank()">æ¦œ</button>
                <button class="action-btn" onclick="sendLike()">â¤ï¸</button>
            </div>
        </div>
    </div>

    <!-- çº¢åŒ…ç»“æœ -->
    <div class="red-packet-modal" id="redPacketModal">
        <div class="red-packet">
            <h2 id="rpTitle">æ­å–œå‘è´¢</h2>
            <div class="red-packet-amount" id="rpAmount">0.00</div>
            <div id="rpMsg"></div>
            <button class="close-btn" onclick="closeRedPacket()">å…³é—­</button>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œ -->
    <div class="rank-modal" id="rankModal">
        <div class="rank-content">
            <div class="rank-header">
                <h2 class="rank-title">çº¢åŒ…æ’è¡Œæ¦œ</h2>
                <button class="close-btn" onclick="closeRank()">å…³é—­</button>
            </div>
            <div id="rankList"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        /* ---------- æ•°æ® ---------- */
        let userName='', robots=[], userAmount=0, rankings=[];
        const robotNames=['å°å¯çˆ±123','ç›´æ’­è¾¾äºº','å¤œçŒ«å­','è¿½æ˜Ÿå°‘å¹´','å¿«ä¹æ¯ä¸€å¤©','åƒç“œç¾¤ä¼—','çƒ­å¿ƒç½‘å‹','åŒ¿åç”¨æˆ·','æœˆå…‰æ—','æ‰“å·¥äºº','ä½›ç³»é’å¹´','äºŒæ¬¡å…ƒæ§','éŸ³ä¹å‘çƒ§å‹','ç”µå½±è¿·','æ¸¸æˆå®…','ç¾é£Ÿå®¶','æ—…è¡Œçˆ±å¥½è€…','å¥èº«è¾¾äºº','æ‘„å½±çˆ±å¥½è€…','æ–‡è‰ºé’å¹´','ç§‘æŠ€æ§','æ—¶å°šè¾¾äºº','å® ç‰©çˆ±å¥½è€…','ä¹¦è™«','ç”»ç”»å°èƒ½æ‰‹','èˆè¹ˆçˆ±å¥½è€…','å”±æ­Œè¾¾äºº','ä¹å™¨æ¼”å¥å®¶','æ‰‹å·¥è¾¾äºº','å›­è‰ºçˆ±å¥½è€…','æ”¶è—å®¶','æ¨¡å‹çˆ±å¥½è€…','åŠ¨æ¼«è¿·','æ¼«ç”»å…š','å°è¯´è¿·','è¯—è¯çˆ±å¥½è€…','ä¹¦æ³•è¾¾äºº','å›´æ£‹é«˜æ‰‹','è±¡æ£‹çˆ±å¥½è€…','æ‰‘å…‹ç©å®¶','éº»å°†è¾¾äºº','éª°å­é«˜æ‰‹','æŠ½å¥–é”¦é²¤','è¿æ°”çˆ†æ£š','æ¬§çš‡','éé…‹','éæ´²äºº','æ¬§æ´²äºº','äºšæ´²äºº','ç¾æ´²äºº','éæ´²å°ç™½è„¸','æ¬§æ´²å¤§åœŸè±ª','äºšæ´²å°å…¬ä¸¾','ç¾æ´²å°ç‹å­','æ¾³æ´²å°è¢‹é¼ ','ç›´æ’­å°èƒ½æ‰‹','æŠ¢çº¢åŒ…é«˜æ‰‹','æ‰‹é€Ÿè¾¾äºº','ç½‘é€Ÿé£å¿«','ååº”ç¥é€Ÿ','å¹¸è¿æ˜Ÿ','æ‹›è´¢çŒ«','è´¢ç¥çˆ·','é”¦é²¤é™„ä½“','å¥½è¿è¿è¿','å–œæ°”æ´‹æ´‹','çº¢çº¢ç«ç«','å¤§å‰å¤§åˆ©','ä¸‡äº‹å¦‚æ„','å¿ƒæƒ³äº‹æˆ','ä¸€å¸†é£é¡º','äºŒé¾™è…¾é£','ä¸‰ç¾Šå¼€æ³°','å››å­£å¹³å®‰','äº”ç¦ä¸´é—¨','å…­å…­å¤§é¡º','ä¸ƒæ˜Ÿé«˜ç…§','å…«æ–¹æ¥è´¢','ä¹ä¹åŒå¿ƒ','åå…¨åç¾','ç™¾äº‹å¯ä¹','åƒäº‹å‰ç¥¥','ä¸‡äº‹å¦‚æ„','å¿ƒæƒ³äº‹æˆ','ä¸€å¸†é£é¡º','äºŒé¾™è…¾é£','ä¸‰ç¾Šå¼€æ³°','å››å­£å¹³å®‰','äº”ç¦ä¸´é—¨','å…­å…­å¤§é¡º','ä¸ƒæ˜Ÿé«˜ç…§','å…«æ–¹æ¥è´¢','ä¹ä¹åŒå¿ƒ','åå…¨åç¾','ç™¾äº‹å¯ä¹','åƒäº‹å‰ç¥¥','ä¸‡äº‹å¦‚æ„','å¿ƒæƒ³äº‹æˆ','ä¸€å¸†é£é¡º','äºŒé¾™è…¾é£'];
        const chatMessages=['ä¸»æ’­å¥½æ£’ï¼','666666','å¤ªå‰å®³äº†','åŠ æ²¹åŠ æ²¹','æ”¯æŒæ”¯æŒ','æ¥äº†æ¥äº†','å‰æ’å›´è§‚','ç²¾å½©ç²¾å½©','å¥½çœ‹å¥½çœ‹','èµèµèµ','ä¸»æ’­æœ€ç¾','ä¸»æ’­æœ€å¸…','çˆ±äº†çˆ±äº†','å…³æ³¨äº†','å·²ç‚¹èµ','ç¤¼ç‰©èµ°ä¸€æ³¢','å¤§æ°”å¤§æ°”','ä¼˜ç§€ä¼˜ç§€','å‰å®³äº†','å¤ªæ£’äº†','ç»§ç»­ç»§ç»­','ä¸é”™ä¸é”™','å¾ˆå¥½å¾ˆå¥½','å¯ä»¥å¯ä»¥','è¡Œè€Œè¡Œè€Œ','æ”¯æŒä¸»æ’­','ä¸»æ’­åŠ æ²¹','è¶Šæ¥è¶Šå¥½','è¶Šæ¥è¶Šæ£’','è¶Šæ¥è¶Šç«','ç›´æ’­çœŸå¥½çœ‹','å†…å®¹çœŸç²¾å½©','è¡¨æ¼”çœŸå‡ºè‰²','æŠ€æœ¯çœŸé«˜è¶…','æ‰è‰ºçœŸä¸°å¯Œ'];

        /* ---------- ç›´æ’­æµ ---------- */
        function loadLiveStream(){
            const video=document.getElementById('liveVideo'),placeholder=document.getElementById('videoPlaceholder');
            if(Hls.isSupported()){
                const hls=new Hls();
                hls.loadSource('https://hwapi.yntv.net:443/ew265l/9gp7eg.m3u8');
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED,()=>{placeholder.style.display='none';video.play();});
                hls.on(Hls.Events.ERROR,()=>{placeholder.textContent='ç›´æ’­åŠ è½½å¤±è´¥';});
            }else if(video.canPlayType('application/vnd.apple.mpegurl')){
                video.src='https://hwapi.yntv.net:443/ew265l/9gp7eg.m3u8';
                video.addEventListener('loadedmetadata',()=>{placeholder.style.display='none';video.play();});
                video.addEventListener('error',()=>{placeholder.textContent='ç›´æ’­åŠ è½½å¤±è´¥';});
            }else{placeholder.textContent='æµè§ˆå™¨ä¸æ”¯æŒç›´æ’­';}
        }

        /* ---------- è¿›å…¥/é€€å‡º ---------- */
        function startLive(){
            const inp=document.getElementById('userNameInput');
            if(!inp.value.trim()){alert('è¯·è¾“å…¥æ˜µç§°');return;}
            userName=inp.value.trim();
            document.getElementById('nameInputPage').style.display='none';
            document.getElementById('liveRoomPage').style.display='flex';
            initRobots();loadLiveStream();startChat();startRedPacketLoop();updateRank();
        }

        /* ---------- æœºå™¨äºº ---------- */
        function initRobots(){robots=[];for(let i=0;i<100;i++)robots.push({name:robotNames[i],amount:0});}
        function startChat(){
            setInterval(()=>{
                if(Math.random()>0.5){
                    const r=robots[Math.floor(Math.random()*robots.length)];
                    const m=chatMessages[Math.floor(Math.random()*chatMessages.length)];
                    addChat(r.name,m);
                }
            },1000);
        }
        function addChat(username,msg){
            const box=document.getElementById('chatContainer');
            const d=document.createElement('div');d.className='chat-message';
            d.innerHTML=`<span class="chat-username">${username}:</span>${msg}`;
            box.appendChild(d);if(box.children.length>100)box.removeChild(box.firstChild);
            scrollChatToBottom();
        }
        function scrollChatToBottom(){
            const sc=document.getElementById('chatScroll');
            sc.scrollTop=sc.scrollHeight;
        }

        /* ---------- ç”¨æˆ·å‘è¨€ ---------- */
        function sendUserMsg(){
            const inp=document.getElementById('msgInput');
            if(!inp.value.trim())return;
            addChat(userName,inp.value.trim());inp.value='';
        }
        document.getElementById('msgInput').addEventListener('keypress',e=>{if(e.key==='Enter')sendUserMsg();});

        /* ---------- ç‚¹èµ ---------- */
        function sendLike(){
            const span=document.getElementById('likeCount');
            const n=parseFloat(span.textContent);
            span.textContent=(n+0.1).toFixed(1)+'k';
            addChat(userName,'â¤ï¸ ç‚¹èµ');
        }

        /* ---------- çº¢åŒ…ç³»ç»Ÿ ---------- */
        let rpAmount=0,rpCount=0,rpTimeout=null;
        function startRedPacketLoop(){
            sendRedPacket();
            setInterval(sendRedPacket,40000);
        }
        function sendRedPacket(){
            rpAmount=Math.random()*100+10;rpCount=50;
            const btn=document.getElementById('redPacketBtn');btn.classList.remove('hidden');
            // æœºå™¨äººæŠ¢
            const grabCount=Math.min(rpCount,Math.floor(Math.random()*30)+20);
            for(let i=0;i<grabCount;i++){
                const r=robots[Math.floor(Math.random()*robots.length)];
                r.amount+=parseFloat((rpAmount/grabCount*(0.5+Math.random())).toFixed(2));
            }
            rpCount-=grabCount;
            addChat('ç³»ç»Ÿ','ğŸ§§çº¢åŒ…å·²å‘æ”¾ï¼Œé™æ—¶1åˆ†é’Ÿï¼');
            if(rpTimeout)clearTimeout(rpTimeout);
            rpTimeout=setTimeout(()=>{document.getElementById('redPacketBtn').classList.add('hidden');},60000);
            updateRank();
        }
        function grabRedPacket(){
            if(rpCount<=0){showRP(0,'æ‰‹æ…¢äº†ï¼Œçº¢åŒ…å·²è¢«æŠ¢å…‰ï¼');return;}
            const amount=parseFloat((rpAmount/rpCount*(0.5+Math.random())).toFixed(2));
            userAmount+=amount;rpCount--;
            showRP(amount,`æ­å–œæŠ¢åˆ° ${amount} å…ƒï¼`);
            document.getElementById('redPacketBtn').classList.add('hidden');
            if(rpTimeout){clearTimeout(rpTimeout);rpTimeout=null;}
            updateRank();
        }
        function showRP(amount,msg){
            document.getElementById('rpAmount').textContent=amount>0?`Â¥${amount}`:'æ‰‹æ…¢äº†';
            document.getElementById('rpMsg').textContent=msg;
            document.getElementById('redPacketModal').style.display='flex';
        }
        function closeRedPacket(){document.getElementById('redPacketModal').style.display='none';}

        /* ---------- æ’è¡Œæ¦œ ---------- */
        function updateRank(){
            rankings=[...robots,{name:userName,amount:userAmount}];
            rankings.sort((a,b)=>b.amount-a.amount);
        }
        function showRank(){
            const box=document.getElementById('rankList');box.innerHTML='';
            rankings.slice(0,20).forEach((u,i)=>{
                const d=document.createElement('div');d.className=`rank-item ${u.name===userName?'current-user':''}`;
                d.innerHTML=`<div class="rank-number">${i+1}</div><div class="rank-name">${u.name}</div><div class="rank-amount">Â¥${u.amount.toFixed(2)}</div>`;
                box.appendChild(d);
            });
            document.getElementById('rankModal').style.display='block';
        }
        function closeRank(){document.getElementById('rankModal').style.display='none';}
    </script>
</body>
</html>
