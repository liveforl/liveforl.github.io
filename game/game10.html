<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI 2048 对战</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Arial,Helvetica,sans-serif;background:#faf8ef;color:#776e65;overflow-x:hidden;padding-bottom:40px}
        .container{max-width:100vw;padding:8px}
        h1{text-align:center;color:#776e65;margin:8px 0;font-size:clamp(18px,3.5vw,24px)}
        .controls{text-align:center;margin:8px 0}
        button{background:#8f7a66;color:#f9f6f2;border:none;padding:6px 12px;border-radius:3px;font-size:12px;cursor:pointer;margin:2px;touch-action:manipulation;-webkit-appearance:none;-moz-appearance:none;appearance:none}
        button:hover{background:#9f8a76}button:active{background:#7f6a56}
        .games-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin:10px 0}
        .game-container{background:#bbada0;border-radius:4px;padding:6px;flex:0 1 calc(50% - 3px);max-width:calc(50% - 3px);box-sizing:border-box;position:relative}
        .game-title{text-align:center;color:#eee4da;margin-bottom:6px;font-size:clamp(9px,2vw,11px);font-weight:bold;line-height:1.2}
        .score{text-align:center;color:#eee4da;margin-bottom:6px;font-size:clamp(10px,2.2vw,12px)}
        .grid{display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);gap:2px;aspect-ratio:1;max-width:100%}
        .cell{background:rgba(238,228,218,.35);border-radius:2px;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#776e65;font-size:clamp(10px,3vw,14px);transition:all .15s ease-in-out;position:relative}
        .tile{position:absolute;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:bold;border-radius:2px;transition:all .15s ease-in-out;font-size:clamp(10px,3vw,14px)}
        .tile-2{background:#eee4da;color:#776e65}
        .tile-4{background:#ede0c8;color:#776e65}
        .tile-8{background:#f2b179;color:#f9f6f2}
        .tile-16{background:#f59563;color:#f9f6f2}
        .tile-32{background:#f67c5f;color:#f9f6f2}
        .tile-64{background:#f65e3b;color:#f9f6f2}
        .tile-128{background:#edcf72;color:#f9f6f2;font-size:clamp(9px,2.5vw,12px)}
        .tile-256{background:#edcc61;color:#f9f6f2;font-size:clamp(9px,2.5vw,12px)}
        .tile-512{background:#edc850;color:#f9f6f2;font-size:clamp(9px,2.5vw,12px)}
        .tile-1024{background:#edc53f;color:#f9f6f2;font-size:clamp(8px,2.2vw,10px)}
        .tile-2048{background:#edc22e;color:#f9f6f2;font-size:clamp(8px,2.2vw,10px)}
        .game-over{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(238,228,218,.9);display:none;flex-direction:column;align-items:center;justify-content:center;border-radius:4px;z-index:10}
        .game-over.show{display:flex}
        .game-over-text{font-size:clamp(14px,3vw,18px);font-weight:bold;color:#776e65;margin-bottom:10px}
        .restart-btn{background:#8f7a66;color:#f9f6f2;border:none;padding:6px 12px;border-radius:3px;font-size:11px;cursor:pointer}
        .version{position:fixed;bottom:3px;left:3px;color:#776e65;font-size:10px}
        @media (max-width:320px){
            .game-container{flex:0 1 calc(50% - 2px);max-width:calc(50% - 2px);padding:5px}
            .grid{gap:1px}
            button{padding:5px 10px;font-size:11px}
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI 2048 对战</h1>
        <div class="controls">
            <button onclick="startAllAI()">开始所有AI</button>
            <button onclick="stopAllAI()">停止所有AI</button>
            <button onclick="resetAll()">重置所有</button>
        </div>
        <div class="games-grid">
            <div class="game-container">
                <div class="game-title">简单型AI</div>
                <div class="score">得分: <span id="score1">0</span></div>
                <div class="grid" id="grid1"></div>
                <div class="game-over" id="game-over-1">
                    <div class="game-over-text">游戏结束!</div>
                    <button class="restart-btn" onclick="resetGame(0)">重新开始</button>
                </div>
            </div>
            <div class="game-container">
                <div class="game-title">深度思考型AI</div>
                <div class="score">得分: <span id="score2">0</span></div>
                <div class="grid" id="grid2"></div>
                <div class="game-over" id="game-over-2">
                    <div class="game-over-text">游戏结束!</div>
                    <button class="restart-btn" onclick="resetGame(1)">重新开始</button>
                </div>
            </div>
            <div class="game-container">
                <div class="game-title">无脑型AI</div>
                <div class="score">得分: <span id="score3">0</span></div>
                <div class="grid" id="grid3"></div>
                <div class="game-over" id="game-over-3">
                    <div class="game-over-text">游戏结束!</div>
                    <button class="restart-btn" onclick="resetGame(2)">重新开始</button>
                </div>
            </div>
            <div class="game-container">
                <div class="game-title">左、上、右、下循环型AI</div>
                <div class="score">得分: <span id="score4">0</span></div>
                <div class="grid" id="grid4"></div>
                <div class="game-over" id="game-over-4">
                    <div class="game-over-text">游戏结束!</div>
                    <button class="restart-btn" onclick="resetGame(3)">重新开始</button>
                </div>
            </div>
        </div>
    </div>
    <div class="version">版本: V0.2-正式</div>

    <script>
        class Game2048{
            constructor(gridId,scoreId,gameOverId){
                this.gridId=gridId;this.scoreId=scoreId;this.gameOverId=gameOverId;
                this.grid=[];this.score=0;this.size=4;this.init();
            }
            init(){
                const el=document.getElementById(this.gridId);
                el.innerHTML='';this.grid=[];this.score=0;
                for(let i=0;i<this.size;i++){
                    this.grid[i]=[];
                    for(let j=0;j<this.size;j++){
                        this.grid[i][j]=0;
                        const c=document.createElement('div');
                        c.className='cell';c.id=`${this.gridId}-cell-${i}-${j}`;
                        el.appendChild(c);
                    }
                }
                this.addRandomTile();this.addRandomTile();this.updateDisplay();this.hideGameOver();
            }
            addRandomTile(){
                const emp=[];
                for(let i=0;i<this.size;i++)for(let j=0;j<this.size;j++)if(this.grid[i][j]===0)emp.push({x:i,y:j});
                if(emp.length){const r=emp[Math.floor(Math.random()*emp.length)];this.grid[r.x][r.y]=Math.random()<.9?2:4;}
            }
            updateDisplay(){
                for(let i=0;i<this.size;i++){
                    for(let j=0;j<this.size;j++){
                        const cell=document.getElementById(`${this.gridId}-cell-${i}-${j}`);
                        cell.innerHTML='';
                        if(this.grid[i][j]){
                            const t=document.createElement('div');
                            t.className=`tile tile-${this.grid[i][j]}`;
                            t.textContent=this.grid[i][j];
                            cell.appendChild(t);
                        }
                    }
                }
                document.getElementById(this.scoreId).textContent=this.score;
            }
            showGameOver(){document.getElementById(this.gameOverId).classList.add('show')}
            hideGameOver(){document.getElementById(this.gameOverId).classList.remove('show')}
            move(d){
                let moved=false;const ng=this.grid.map(r=>[...r]);
                const merge=(arr)=>{
                    const a=arr.filter(v=>v);
                    for(let i=0;i<a.length-1;i++)if(a[i]===a[i+1]){a[i]*=2;this.score+=a[i];a.splice(i+1,1);}
                    while(a.length<this.size)a.push(0);
                    return a;
                };
                if(d==='left')for(let i=0;i<this.size;i++){const m=merge(this.grid[i]);for(let j=0;j<this.size;j++){if(this.grid[i][j]!==m[j])moved=true;ng[i][j]=m[j];}}
                if(d==='right')for(let i=0;i<this.size;i++){const m=merge(this.grid[i].slice().reverse()).reverse();for(let j=0;j<this.size;j++){if(this.grid[i][j]!==m[j])moved=true;ng[i][j]=m[j];}}
                if(d==='up')for(let j=0;j<this.size;j++){const col=[];for(let i=0;i<this.size;i++)col.push(this.grid[i][j]);const m=merge(col);for(let i=0;i<this.size;i++){if(this.grid[i][j]!==m[i])moved=true;ng[i][j]=m[i];}}
                if(d==='down')for(let j=0;j<this.size;j++){const col=[];for(let i=0;i<this.size;i++)col.push(this.grid[i][j]);const m=merge(col.slice().reverse()).reverse();for(let i=0;i<this.size;i++){if(this.grid[i][j]!==m[i])moved=true;ng[i][j]=m[i];}}
                if(moved){this.grid=ng;this.addRandomTile();this.updateDisplay();if(!this.canMove())this.showGameOver();}
                return moved;
            }
            canMove(){
                for(let i=0;i<this.size;i++)for(let j=0;j<this.size;j++){
                    if(this.grid[i][j]===0)return true;
                    if(j<this.size-1&&this.grid[i][j]===this.grid[i][j+1])return true;
                    if(i<this.size-1&&this.grid[i][j]===this.grid[i+1][j])return true;
                }
                return false;
            }
        }
        class AI{
            constructor(g,type){this.game=g;this.type=type;this.running=false;this.step=0;}
            makeMove(){
                if(!this.game.canMove())return false;
                let dir;
                if(this.type==='simple')dir=this.simpleMove();
                else if(this.type==='deep')dir=this.deepMove();
                else if(this.type==='random')dir=['up','down','left','right'][Math.floor(Math.random()*4)];
                else if(this.type==='cycle'){
                    const order=['left','up','right','down'];
                    dir=order[this.step%4];this.step++;
                }
                return this.game.move(dir);
            }
            simpleMove(){
                const dirs=['left','up','right','down'];
                for(const d of dirs){const tg=this.game.grid.map(r=>[...r]),ts=this.game.score;if(this.game.move(d)){this.game.grid=tg;this.game.score=ts;return d;}}
                return dirs[Math.floor(Math.random()*4)];
            }
            deepMove(){
                const dirs=['left','up','right','down'];let best=-1,bestd=dirs[0];
                for(const d of dirs){
                    const tg=this.game.grid.map(r=>[...r]),ts=this.game.score;
                    if(this.game.move(d)){const s=this.evaluate();if(s>best){best=s;bestd=d;}this.game.grid=tg;this.game.score=ts;}
                }
                return bestd;
            }
            evaluate(){
                let s=0,size=this.game.size;
                for(let i=0;i<size;i++)for(let j=0;j<size-1;j++)if(this.game.grid[i][j]===this.game.grid[i][j+1])s+=this.game.grid[i][j];
                for(let j=0;j<size;j++)for(let i=0;i<size-1;i++)if(this.game.grid[i][j]===this.game.grid[i+1][j])s+=this.game.grid[i][j];
                const max=Math.max(...this.game.grid.flat());
                if(this.game.grid[0][0]===max||this.game.grid[0][3]===max||this.game.grid[3][0]===max||this.game.grid[3][3]===max)s+=max*2;
                return s;
            }
            start(){this.running=true;this.run()}
            stop(){this.running=false;this.step=0;}
            run(){if(!this.running)return;if(this.game.canMove()){this.makeMove();setTimeout(()=>this.run(),100);}else this.running=false;}
        }
        const games=[
            new Game2048('grid1','score1','game-over-1'),
            new Game2048('grid2','score2','game-over-2'),
            new Game2048('grid3','score3','game-over-3'),
            new Game2048('grid4','score4','game-over-4')
        ];
        const ais=[
            new AI(games[0],'simple'),
            new AI(games[1],'deep'),
            new AI(games[2],'random'),
            new AI(games[3],'cycle')
        ];
        function startAllAI(){ais.forEach(ai=>ai.start())}
        function stopAllAI(){ais.forEach(ai=>ai.stop())}
        function resetAll(){stopAllAI();games.forEach(g=>g.init())}
        function resetGame(i){ais[i].stop();games[i].init()}
    </script>
</body>
</html>
